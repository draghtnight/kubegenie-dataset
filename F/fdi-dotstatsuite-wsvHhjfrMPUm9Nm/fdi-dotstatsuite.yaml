apiVersion: v1
kind: ServiceAccount
metadata:
  name: release-name-fdi-dotstatsuite-authz
  labels:
    helm.sh/chart: fdi-dotstatsuite-0.2.14
    app.kubernetes.io/name: fdi-dotstatsuite
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: 7.2.0
    app.kubernetes.io/managed-by: Helm-authz
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: release-name-fdi-dotstatsuite-design
  labels:
    helm.sh/chart: fdi-dotstatsuite-0.2.14
    app.kubernetes.io/name: fdi-dotstatsuite
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: 7.2.0
    app.kubernetes.io/managed-by: Helm-design
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: release-name-fdi-dotstatsuite-reset
  labels:
    helm.sh/chart: fdi-dotstatsuite-0.2.14
    app.kubernetes.io/name: fdi-dotstatsuite
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: 7.2.0
    app.kubernetes.io/managed-by: Helm-reset
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: release-name-fdi-dotstatsuite-stable
  labels:
    helm.sh/chart: fdi-dotstatsuite-0.2.14
    app.kubernetes.io/name: fdi-dotstatsuite
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: 7.2.0
    app.kubernetes.io/managed-by: Helm-stable
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: release-name-fdi-dotstatsuite-staging
  labels:
    helm.sh/chart: fdi-dotstatsuite-0.2.14
    app.kubernetes.io/name: fdi-dotstatsuite
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: 7.2.0
    app.kubernetes.io/managed-by: Helm-staging
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: release-name-fdi-dotstatsuite-transfer
  labels:
    helm.sh/chart: fdi-dotstatsuite-0.2.14
    app.kubernetes.io/name: fdi-dotstatsuite
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: 7.2.0
    app.kubernetes.io/managed-by: Helm-transfer
---
kind: Secret
apiVersion: v1
metadata:
  name: -db-secret
data:
  sapassword: null
type: Opaque
---
kind: Secret
apiVersion: v1
metadata:
  name: -mssql-common
data:
  password: null
type: Opaque
---
kind: Secret
apiVersion: v1
metadata:
  name: -mssql-read-only
data:
  password: null
type: Opaque
---
kind: Secret
apiVersion: v1
metadata:
  name: -mssql-sdmx-design-data
data:
  password: null
type: Opaque
---
kind: Secret
apiVersion: v1
metadata:
  name: -mssql-sdmx-design-structure
data:
  password: null
type: Opaque
---
kind: Secret
apiVersion: v1
metadata:
  name: -mssql-sdmx-reset-data
data:
  password: null
type: Opaque
---
kind: Secret
apiVersion: v1
metadata:
  name: -mssql-sdmx-reset-structure
data:
  password: null
type: Opaque
---
kind: Secret
apiVersion: v1
metadata:
  name: -mssql-sdmx-stable-data
data:
  password: null
type: Opaque
---
kind: Secret
apiVersion: v1
metadata:
  name: -mssql-sdmx-stable-structure
data:
  password: null
type: Opaque
---
kind: Secret
apiVersion: v1
metadata:
  name: -mssql-sdmx-staging-data
data:
  password: null
type: Opaque
---
kind: Secret
apiVersion: v1
metadata:
  name: -mssql-sdmx-staging-structure
data:
  password: null
type: Opaque
---
kind: Secret
apiVersion: v1
metadata:
  name: -smtp
data:
  password: null
type: Opaque
---
kind: ConfigMap
apiVersion: v1
metadata:
  name: -authz
data:
  auth__TokenUrl: ""
  auth__allowAnonymous: "true"
  auth__authority: ""
  auth__authorizationUrl: ""
  auth__claimsMapping__email: upn
  auth__claimsMapping__groups: roles
  auth__clientId: ""
  auth__enabled: "true"
  auth__requireHttps: "false"
  auth__scopes__0: openid
  auth__scopes__1: profile
  auth__scopes__2: email
  auth__scopes__3: /access_as_app
  auth__validateIssuer: "false"
  auth__showPii: "true"
---
kind: ConfigMap
apiVersion: v1
metadata:
  name: -mssql
data:
  COMMON_DB: commonDb
  COMMON_USER: commonUser
  READ_ONLY_USER: readOnlyUser
  RESET_DATA_DB: sdmxResetDataDb
  RESET_DATA_USER: sdmxResetDataUser
  RESET_STRUCTURE_DB: sdmxResetStructureDb
  RESET_STRUCTURE_USER: sdmxResetStructureUser
  STABLE_DATA_DB: sdmxStableDataDb
  STABLE_DATA_USER: sdmxStableDataUser
  STABLE_STRUCTURE_DB: sdmxStableStructureDb
  STABLE_STRUCTURE_USER: sdmxStableStructureUser
  DESIGN_DATA_DB: sdmxDesignDataDb
  DESIGN_DATA_USER: sdmxDesignDataUser
  DESIGN_STRUCTURE_DB: sdmxDesignStructureDb
  DESIGN_STRUCTURE_USER: sdmxDesignStructureUser
  STAGING_DATA_DB: sdmxStagingDataDb
  STAGING_DATA_USER: sdmxStagingDataUser
  STAGING_STRUCTURE_DB: sdmxStagingStructureDb
  STAGING_STRUCTURE_USER: sdmxStagingStructureUser
  SA_USER: null
---
apiVersion: v1
kind: Service
metadata:
  name: release-name-fdi-dotstatsuite-authz
  labels:
    helm.sh/chart: fdi-dotstatsuite-0.2.14
    app.kubernetes.io/name: fdi-dotstatsuite
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: 7.2.0
    app.kubernetes.io/managed-by: Helm-authz
spec:
  type: ClusterIP
  ports:
    - port: 80
      targetPort: http
      protocol: TCP
      name: http-authz
  selector:
    app.kubernetes.io/name: fdi-dotstatsuite
    app.kubernetes.io/instance: release-name-authz
---
apiVersion: v1
kind: Service
metadata:
  name: release-name-fdi-dotstatsuite-design
  labels:
    helm.sh/chart: fdi-dotstatsuite-0.2.14
    app.kubernetes.io/name: fdi-dotstatsuite
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: 7.2.0
    app.kubernetes.io/managed-by: Helm-design
spec:
  type: ClusterIP
  ports:
    - port: 80
      targetPort: http
      protocol: TCP
      name: http-design
  selector:
    app.kubernetes.io/name: fdi-dotstatsuite
    app.kubernetes.io/instance: release-name-design
---
apiVersion: v1
kind: Service
metadata:
  name: release-name-fdi-dotstatsuite-reset
  labels:
    helm.sh/chart: fdi-dotstatsuite-0.2.14
    app.kubernetes.io/name: fdi-dotstatsuite
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: 7.2.0
    app.kubernetes.io/managed-by: Helm-reset
spec:
  type: ClusterIP
  ports:
    - port: 80
      targetPort: http
      protocol: TCP
      name: http-reset
  selector:
    app.kubernetes.io/name: fdi-dotstatsuite
    app.kubernetes.io/instance: release-name-reset
---
apiVersion: v1
kind: Service
metadata:
  name: release-name-fdi-dotstatsuite-stable
  labels:
    helm.sh/chart: fdi-dotstatsuite-0.2.14
    app.kubernetes.io/name: fdi-dotstatsuite
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: 7.2.0
    app.kubernetes.io/managed-by: Helm-stable
spec:
  type: ClusterIP
  ports:
    - port: 80
      targetPort: http
      protocol: TCP
      name: http-stable
  selector:
    app.kubernetes.io/name: fdi-dotstatsuite
    app.kubernetes.io/instance: release-name-stable
---
apiVersion: v1
kind: Service
metadata:
  name: release-name-fdi-dotstatsuite-staging
  labels:
    helm.sh/chart: fdi-dotstatsuite-0.2.14
    app.kubernetes.io/name: fdi-dotstatsuite
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: 7.2.0
    app.kubernetes.io/managed-by: Helm-staging
spec:
  type: ClusterIP
  ports:
    - port: 80
      targetPort: http
      protocol: TCP
      name: http-staging
  selector:
    app.kubernetes.io/name: fdi-dotstatsuite
    app.kubernetes.io/instance: release-name-staging
---
apiVersion: v1
kind: Service
metadata:
  name: release-name-fdi-dotstatsuite-transfer
  labels:
    helm.sh/chart: fdi-dotstatsuite-0.2.14
    app.kubernetes.io/name: fdi-dotstatsuite
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: 7.2.0
    app.kubernetes.io/managed-by: Helm-transfer
spec:
  type: ClusterIP
  ports:
    - port: 80
      targetPort: http
      protocol: TCP
      name: http-transfer
  selector:
    app.kubernetes.io/name: fdi-dotstatsuite
    app.kubernetes.io/instance: release-name-transfer
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: release-name-fdi-dotstatsuite-authz
  labels:
    helm.sh/chart: fdi-dotstatsuite-0.2.14
    app.kubernetes.io/name: fdi-dotstatsuite
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: 7.2.0
    app.kubernetes.io/managed-by: Helm-authz
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: fdi-dotstatsuite
      app.kubernetes.io/instance: release-name-authz
  template:
    metadata:
      annotations:
        traffic.sidecar.istio.io/excludeOutboundPorts: "1433"
      labels:
        app.kubernetes.io/name: fdi-dotstatsuite
        app.kubernetes.io/instance: release-name-authz
    spec:
      imagePullSecrets:
        - name: registry-pull-secret
      serviceAccountName: release-name-fdi-dotstatsuite-authz
      securityContext: {}
      containers:
        - name: release-name-fdi-dotstatsuite-authz
          securityContext:
            allowPrivilegeEscalation: false
            capabilities:
              drop:
                "": NET_RAW
            readOnlyRootFilesystem: true
          image: siscc/dotstatsuite-core-auth-management:master
          imagePullPolicy: Always
          envFrom:
            - configMapRef:
                name: -mssql
            - configMapRef:
                name: -authz
          env:
            - name: COMMON_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: -mssql-common
                  key: password
            - name: DotStatSuiteCoreCommonDbConnectionString
              value: Server= ;Database=$(COMMON_DB);User=$(COMMON_USER);Password=$(COMMON_PASSWORD);
          ports:
            - name: http
              containerPort: 80
              protocol: TCP
          livenessProbe:
            httpGet:
              path: /live
              port: http
          readinessProbe:
            httpGet:
              path: /health
              port: http
          resources:
            seccompProfile:
              type: RuntimeDefault
      initContainers:
        - name: fdi-dotstatsuite-dbup-common
          image: siscc/dotstatsuite-dbup:master
          imagePullPolicy: Always
          envFrom:
            - configMapRef:
                name: -mssql
          env:
            - name: SA_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: -db-secret
                  key: sapassword
            - name: COMMON_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: -mssql-common
                  key: password
          command:
            - bash
            - -c
          args:
            - dotnet DotStat.DbUp.dll upgrade --connectionString "Server= ;Database=$(COMMON_DB);User=$(SA_USER);Password=$(SA_PASSWORD);" --commonDb --loginName $(COMMON_USER) --loginPwd $(COMMON_PASSWORD) --force
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: release-name-fdi-dotstatsuite-design
  labels:
    helm.sh/chart: fdi-dotstatsuite-0.2.14
    app.kubernetes.io/name: fdi-dotstatsuite
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: 7.2.0
    app.kubernetes.io/managed-by: Helm-design
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: fdi-dotstatsuite
      app.kubernetes.io/instance: release-name-design
  template:
    metadata:
      annotations:
        traffic.sidecar.istio.io/excludeOutboundPorts: "1433"
      labels:
        app.kubernetes.io/name: fdi-dotstatsuite
        app.kubernetes.io/instance: release-name-design
    spec:
      imagePullSecrets:
        - name: registry-pull-secret
      serviceAccountName: release-name-fdi-dotstatsuite-design
      securityContext: {}
      containers:
        - name: fdi-dotstatsuite-design
          securityContext:
            allowPrivilegeEscalation: false
            capabilities:
              drop:
                "": NET_RAW
            readOnlyRootFilesystem: true
          image: siscc/sdmxri-nsi-maapi:master
          imagePullPolicy: Always
          envFrom:
            - configMapRef:
                name: -mssql
            - configMapRef:
                name: -authz
          env:
            - name: SA_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: -db-secret
                  key: sapassword
            - name: DESIGN_DATA_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: -mssql-sdmx-design-data
                  key: password
            - name: DESIGN_STRUCTURE_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: -mssql-sdmx-design-structure
                  key: password
            - name: COMMON_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: -mssql-common
                  key: password
            - name: DotStatSuiteCoreCommonDbConnectionString
              value: Server= ;Database=$(COMMON_DB);User=$(COMMON_USER);Password=$(COMMON_PASSWORD);
            - name: SQL_SERVER
              value: null
            - name: SQL_DATABASE
              value: $(DESIGN_STRUCTURE_DB)
            - name: SQL_USER
              value: $(DESIGN_STRUCTURE_USER)
            - name: SQL_PASSWORD
              value: $(DESIGN_STRUCTURE_PASSWORD)
            - name: SENDER_ID
              value: Stable - DotStat v8
            - name: MA_SQL_USER
              value: $(SA_USER)
            - name: MA_SQL_PASSWORD
              value: $(SA_PASSWORD)
            - name: MA_ALWAYS_RESET
              value: "N"
            - name: INSERT_NEW_ITEM_SCHEME_VALUES
              value: "true"
            - name: enableReleaseManagement
              value: "true"
            - name: mappingStore__Id__Default
              value: design
            - name: disseminationDbConnection__dbType
              value: SqlServer
            - name: disseminationDbConnection__connectionString
              value: Server= ;Database=$(DESIGN_DATA_DB);User=$(DESIGN_DATA_USER);Password=$(DESIGN_DATA_PASSWORD);
          ports:
            - name: http
              containerPort: 80
              protocol: TCP
          readinessProbe:
            httpGet:
              path: /health
              port: http
          resources:
            seccompProfile:
              type: RuntimeDefault
      initContainers:
        - name: fdi-dotstatsuite-dbup-design-structure
          image: siscc/dotstatsuite-dbup:master
          imagePullPolicy: Always
          envFrom:
            - configMapRef:
                name: -mssql
          env:
            - name: SA_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: -db-secret
                  key: sapassword
            - name: DESIGN_STRUCTURE_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: -mssql-sdmx-design-structure
                  key: password
            - name: READ_ONLY_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: -mssql-read-only
                  key: password
          command:
            - bash
            - -c
          args:
            - dotnet DotStat.DbUp.dll upgrade --connectionString "Server= ;Database=$(DESIGN_STRUCTURE_DB);User=$(SA_USER);Password=$(SA_PASSWORD);" --mappingStoreDb --loginName $(DESIGN_STRUCTURE_USER) --loginPwd $(DESIGN_STRUCTURE_PASSWORD) --force --alterPassword --ROloginName ${READ_ONLY_USER} --ROloginPwd ${READ_ONLY_PASSWORD}
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: release-name-fdi-dotstatsuite-reset
  labels:
    helm.sh/chart: fdi-dotstatsuite-0.2.14
    app.kubernetes.io/name: fdi-dotstatsuite
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: 7.2.0
    app.kubernetes.io/managed-by: Helm-reset
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: fdi-dotstatsuite
      app.kubernetes.io/instance: release-name-reset
  template:
    metadata:
      annotations:
        traffic.sidecar.istio.io/excludeOutboundPorts: "1433"
      labels:
        app.kubernetes.io/name: fdi-dotstatsuite
        app.kubernetes.io/instance: release-name-reset
    spec:
      imagePullSecrets:
        - name: registry-pull-secret
      serviceAccountName: release-name-fdi-dotstatsuite-reset
      securityContext: {}
      containers:
        - name: fdi-dotstatsuite-reset
          securityContext:
            allowPrivilegeEscalation: false
            capabilities:
              drop:
                "": NET_RAW
            readOnlyRootFilesystem: true
          image: siscc/sdmxri-nsi-maapi:master
          imagePullPolicy: Always
          envFrom:
            - configMapRef:
                name: -mssql
            - configMapRef:
                name: -authz
          env:
            - name: SA_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: -db-secret
                  key: sapassword
            - name: RESET_DATA_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: -mssql-sdmx-reset-data
                  key: password
            - name: RESET_STRUCTURE_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: -mssql-sdmx-reset-structure
                  key: password
            - name: COMMON_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: -mssql-common
                  key: password
            - name: DotStatSuiteCoreCommonDbConnectionString
              value: Server= ;Database=$(COMMON_DB);User=$(COMMON_USER);Password=$(COMMON_PASSWORD);
            - name: SQL_SERVER
              value: null
            - name: SQL_DATABASE
              value: $(RESET_STRUCTURE_DB)
            - name: SQL_USER
              value: $(RESET_STRUCTURE_USER)
            - name: SQL_PASSWORD
              value: $(RESET_STRUCTURE_PASSWORD)
            - name: SENDER_ID
              value: Stable - DotStat v8
            - name: MA_SQL_USER
              value: $(SA_USER)
            - name: MA_SQL_PASSWORD
              value: $(SA_PASSWORD)
            - name: MA_ALWAYS_RESET
              value: "Y"
            - name: INSERT_NEW_ITEM_SCHEME_VALUES
              value: "true"
            - name: enableReleaseManagement
              value: "true"
            - name: mappingStore__Id__Default
              value: reset
            - name: disseminationDbConnection__dbType
              value: SqlServer
            - name: disseminationDbConnection__connectionString
              value: Server= ;Database=$(RESET_DATA_DB);User=$(RESET_DATA_USER);Password=$(RESET_DATA_PASSWORD);
          ports:
            - name: http
              containerPort: 80
              protocol: TCP
          readinessProbe:
            httpGet:
              path: /health
              port: http
          resources:
            seccompProfile:
              type: RuntimeDefault
      initContainers:
        - name: fdi-dotstatsuite-dbup-reset-structure
          image: siscc/dotstatsuite-dbup:master
          imagePullPolicy: Always
          envFrom:
            - configMapRef:
                name: -mssql
          env:
            - name: SA_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: -db-secret
                  key: sapassword
            - name: RESET_STRUCTURE_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: -mssql-sdmx-reset-structure
                  key: password
            - name: READ_ONLY_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: -mssql-read-only
                  key: password
          command:
            - bash
            - -c
          args:
            - dotnet DotStat.DbUp.dll upgrade --connectionString "Server= ;Database=$(RESET_STRUCTURE_DB);User=$(SA_USER);Password=$(SA_PASSWORD);" --mappingStoreDb --loginName $(RESET_STRUCTURE_USER) --loginPwd $(RESET_STRUCTURE_PASSWORD) --force --dropDb --alterPassword --ROloginName ${READ_ONLY_USER} --ROloginPwd ${READ_ONLY_PASSWORD}
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: release-name-fdi-dotstatsuite-stable
  labels:
    helm.sh/chart: fdi-dotstatsuite-0.2.14
    app.kubernetes.io/name: fdi-dotstatsuite
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: 7.2.0
    app.kubernetes.io/managed-by: Helm-stable
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: fdi-dotstatsuite
      app.kubernetes.io/instance: release-name-stable
  template:
    metadata:
      annotations:
        traffic.sidecar.istio.io/excludeOutboundPorts: "1433"
      labels:
        app.kubernetes.io/name: fdi-dotstatsuite
        app.kubernetes.io/instance: release-name-stable
    spec:
      imagePullSecrets:
        - name: registry-pull-secret
      serviceAccountName: release-name-fdi-dotstatsuite-stable
      securityContext: {}
      containers:
        - name: fdi-dotstatsuite-stable
          securityContext:
            allowPrivilegeEscalation: false
            capabilities:
              drop:
                "": NET_RAW
            readOnlyRootFilesystem: true
          image: siscc/sdmxri-nsi-maapi:master
          imagePullPolicy: Always
          envFrom:
            - configMapRef:
                name: -mssql
            - configMapRef:
                name: -authz
          env:
            - name: SA_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: -db-secret
                  key: sapassword
            - name: STABLE_DATA_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: -mssql-sdmx-stable-data
                  key: password
            - name: STABLE_STRUCTURE_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: -mssql-sdmx-stable-structure
                  key: password
            - name: COMMON_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: -mssql-common
                  key: password
            - name: DotStatSuiteCoreCommonDbConnectionString
              value: Server= ;Database=$(COMMON_DB);User=$(COMMON_USER);Password=$(COMMON_PASSWORD);
            - name: SQL_SERVER
              value: null
            - name: SQL_DATABASE
              value: $(STABLE_STRUCTURE_DB)
            - name: SQL_USER
              value: $(STABLE_STRUCTURE_USER)
            - name: SQL_PASSWORD
              value: $(STABLE_STRUCTURE_PASSWORD)
            - name: SENDER_ID
              value: Stable - DotStat v8
            - name: MA_SQL_USER
              value: $(SA_USER)
            - name: MA_SQL_PASSWORD
              value: $(SA_PASSWORD)
            - name: MA_ALWAYS_RESET
              value: "N"
            - name: INSERT_NEW_ITEM_SCHEME_VALUES
              value: "false"
            - name: enableReleaseManagement
              value: "true"
            - name: mappingStore__Id__Default
              value: stable
            - name: disseminationDbConnection__dbType
              value: SqlServer
            - name: disseminationDbConnection__connectionString
              value: Server= ;Database=$(STABLE_DATA_DB);User=$(STABLE_DATA_USER);Password=$(STABLE_DATA_PASSWORD);
          ports:
            - name: http
              containerPort: 80
              protocol: TCP
          readinessProbe:
            httpGet:
              path: /health
              port: http
          resources:
            seccompProfile:
              type: RuntimeDefault
      initContainers:
        - name: fdi-dotstatsuite-dbup-stable-structure
          image: siscc/dotstatsuite-dbup:master
          imagePullPolicy: Always
          envFrom:
            - configMapRef:
                name: -mssql
          env:
            - name: SA_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: -db-secret
                  key: sapassword
            - name: STABLE_STRUCTURE_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: -mssql-sdmx-stable-structure
                  key: password
            - name: READ_ONLY_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: -mssql-read-only
                  key: password
          command:
            - bash
            - -c
          args:
            - dotnet DotStat.DbUp.dll upgrade --connectionString "Server= ;Database=$(STABLE_STRUCTURE_DB);User=$(SA_USER);Password=$(SA_PASSWORD);" --mappingStoreDb --loginName $(STABLE_STRUCTURE_USER) --loginPwd $(STABLE_STRUCTURE_PASSWORD) --force --alterPassword --ROloginName ${READ_ONLY_USER} --ROloginPwd ${READ_ONLY_PASSWORD}
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: release-name-fdi-dotstatsuite-staging
  labels:
    helm.sh/chart: fdi-dotstatsuite-0.2.14
    app.kubernetes.io/name: fdi-dotstatsuite
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: 7.2.0
    app.kubernetes.io/managed-by: Helm-staging
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: fdi-dotstatsuite
      app.kubernetes.io/instance: release-name-staging
  template:
    metadata:
      annotations:
        traffic.sidecar.istio.io/excludeOutboundPorts: "1433"
      labels:
        app.kubernetes.io/name: fdi-dotstatsuite
        app.kubernetes.io/instance: release-name-staging
    spec:
      imagePullSecrets:
        - name: registry-pull-secret
      serviceAccountName: release-name-fdi-dotstatsuite-staging
      securityContext: {}
      containers:
        - name: fdi-dotstatsuite-staging
          securityContext:
            allowPrivilegeEscalation: false
            capabilities:
              drop:
                "": NET_RAW
            readOnlyRootFilesystem: true
          image: siscc/sdmxri-nsi-maapi:master
          imagePullPolicy: Always
          envFrom:
            - configMapRef:
                name: -mssql
            - configMapRef:
                name: -authz
          env:
            - name: SA_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: -db-secret
                  key: sapassword
            - name: STAGING_DATA_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: -mssql-sdmx-staging-data
                  key: password
            - name: STAGING_STRUCTURE_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: -mssql-sdmx-staging-structure
                  key: password
            - name: COMMON_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: -mssql-common
                  key: password
            - name: DotStatSuiteCoreCommonDbConnectionString
              value: Server= ;Database=$(COMMON_DB);User=$(COMMON_USER);Password=$(COMMON_PASSWORD);
            - name: SQL_SERVER
              value: null
            - name: SQL_DATABASE
              value: $(STAGING_STRUCTURE_DB)
            - name: SQL_USER
              value: $(STAGING_STRUCTURE_USER)
            - name: SQL_PASSWORD
              value: $(STAGING_STRUCTURE_PASSWORD)
            - name: SENDER_ID
              value: Stable - DotStat v8
            - name: MA_SQL_USER
              value: $(SA_USER)
            - name: MA_SQL_PASSWORD
              value: $(SA_PASSWORD)
            - name: MA_ALWAYS_RESET
              value: "N"
            - name: INSERT_NEW_ITEM_SCHEME_VALUES
              value: "false"
            - name: enableReleaseManagement
              value: "true"
            - name: mappingStore__Id__Default
              value: staging
            - name: disseminationDbConnection__dbType
              value: SqlServer
            - name: disseminationDbConnection__connectionString
              value: Server= ;Database=$(STAGING_DATA_DB);User=$(STAGING_DATA_USER);Password=$(STAGING_DATA_PASSWORD);
          ports:
            - name: http
              containerPort: 80
              protocol: TCP
          readinessProbe:
            httpGet:
              path: /health
              port: http
          resources:
            seccompProfile:
              type: RuntimeDefault
      initContainers:
        - name: fdi-dotstatsuite-dbup-staging-structure
          image: siscc/dotstatsuite-dbup:master
          imagePullPolicy: Always
          envFrom:
            - configMapRef:
                name: -mssql
          env:
            - name: SA_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: -db-secret
                  key: sapassword
            - name: STAGING_STRUCTURE_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: -mssql-sdmx-staging-structure
                  key: password
            - name: READ_ONLY_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: -mssql-read-only
                  key: password
          command:
            - bash
            - -c
          args:
            - dotnet DotStat.DbUp.dll upgrade --connectionString "Server= ;Database=$(STAGING_STRUCTURE_DB);User=$(SA_USER);Password=$(SA_PASSWORD);" --mappingStoreDb --loginName $(STAGING_STRUCTURE_USER) --loginPwd $(STAGING_STRUCTURE_PASSWORD) --force --alterPassword --ROloginName ${READ_ONLY_USER} --ROloginPwd ${READ_ONLY_PASSWORD}
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: release-name-fdi-dotstatsuite-transfer
  labels:
    helm.sh/chart: fdi-dotstatsuite-0.2.14
    app.kubernetes.io/name: fdi-dotstatsuite
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: 7.2.0
    app.kubernetes.io/managed-by: Helm-transfer
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: fdi-dotstatsuite
      app.kubernetes.io/instance: release-name-transfer
  template:
    metadata:
      annotations:
        traffic.sidecar.istio.io/excludeOutboundPorts: "1433"
      labels:
        app.kubernetes.io/name: fdi-dotstatsuite
        app.kubernetes.io/instance: release-name-transfer
    spec:
      imagePullSecrets:
        - name: registry-pull-secret
      serviceAccountName: release-name-fdi-dotstatsuite-transfer
      securityContext: {}
      containers:
        - name: release-name-fdi-dotstatsuite-transfer
          securityContext:
            allowPrivilegeEscalation: false
            capabilities:
              drop:
                "": NET_RAW
            readOnlyRootFilesystem: true
          image: siscc/dotstatsuite-core-transfer:master
          imagePullPolicy: Always
          envFrom:
            - configMapRef:
                name: -mssql
            - configMapRef:
                name: -authz
          env:
            - name: SA_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: -db-secret
                  key: sapassword
            - name: COMMON_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: -mssql-common
                  key: password
            - name: SMTP_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: -smtp
                  key: password
            - name: STABLE_DATA_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: -mssql-sdmx-stable-data
                  key: password
            - name: STABLE_STRUCTURE_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: -mssql-sdmx-stable-structure
                  key: password
            - name: RESET_DATA_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: -mssql-sdmx-reset-data
                  key: password
            - name: RESET_STRUCTURE_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: -mssql-sdmx-reset-structure
                  key: password
            - name: DESIGN_DATA_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: -mssql-sdmx-design-data
                  key: password
            - name: DESIGN_STRUCTURE_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: -mssql-sdmx-design-structure
                  key: password
            - name: STAGING_DATA_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: -mssql-sdmx-staging-data
                  key: password
            - name: STAGING_STRUCTURE_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: -mssql-sdmx-staging-structure
                  key: password
            - name: MaxTransferErrorAmount
              value: "0"
            - name: MaxTextAttributeLength
              value: "150"
            - name: MinPercentageDiskSpace
              value: "10"
            - name: DefaultLanguageCode
              value: en
            - name: SmtpHost
              value: ""
            - name: SmtpPort
              value: "587"
            - name: SmtpEnableSsl
              value: "true"
            - name: SmtpUserName
              value: ""
            - name: SmtpUserPassword
              value: $(SMTP_PASSWORD)
            - name: MailFrom
              value: ""
            - name: DotStatSuiteCoreCommonDbConnectionString
              value: Server= ;Database=$(COMMON_DB);User=$(COMMON_USER);Password=$(COMMON_PASSWORD);
            - name: SpacesInternal__0__Id
              value: stable
            - name: SpacesInternal__0__DotStatSuiteCoreStructDbConnectionString
              value: Server= ;Database=$(STABLE_STRUCTURE_DB);User=$(STABLE_STRUCTURE_USER);Password=$(STABLE_STRUCTURE_PASSWORD);
            - name: SpacesInternal__0__DotStatSuiteCoreDataDbConnectionString
              value: Server= ;Database=$(STABLE_DATA_DB);User=$(STABLE_DATA_USER);Password=$(STABLE_DATA_PASSWORD);
            - name: SpacesInternal__0__DataImportTimeOutInMinutes
              value: "5"
            - name: SpacesInternal__0__DatabaseCommandTimeoutInSec
              value: "270"
            - name: SpacesInternal__0__AutoLog2DB
              value: "true"
            - name: SpacesInternal__0__AutoLog2DBLogLevel
              value: Notice
            - name: SpacesInternal__1__Id
              value: reset
            - name: SpacesInternal__1__DotStatSuiteCoreStructDbConnectionString
              value: Server= ;Database=$(RESET_STRUCTURE_DB);User=$(RESET_STRUCTURE_USER);Password=$(RESET_STRUCTURE_PASSWORD);
            - name: SpacesInternal__1__DotStatSuiteCoreDataDbConnectionString
              value: Server= ;Database=$(RESET_DATA_DB);User=$(RESET_DATA_USER);Password=$(RESET_DATA_PASSWORD);
            - name: SpacesInternal__1__DataImportTimeOutInMinutes
              value: "5"
            - name: SpacesInternal__1__DatabaseCommandTimeoutInSec
              value: "270"
            - name: SpacesInternal__1__AutoLog2DB
              value: "true"
            - name: SpacesInternal__1__AutoLog2DBLogLevel
              value: Notice
            - name: SpacesInternal__2__Id
              value: design
            - name: SpacesInternal__2__DotStatSuiteCoreStructDbConnectionString
              value: Server= ;Database=$(DESIGN_STRUCTURE_DB);User=$(DESIGN_STRUCTURE_USER);Password=$(DESIGN_STRUCTURE_PASSWORD);
            - name: SpacesInternal__2__DotStatSuiteCoreDataDbConnectionString
              value: Server= ;Database=$(DESIGN_DATA_DB);User=$(DESIGN_DATA_USER);Password=$(DESIGN_DATA_PASSWORD);
            - name: SpacesInternal__2__DataImportTimeOutInMinutes
              value: "5"
            - name: SpacesInternal__2__DatabaseCommandTimeoutInSec
              value: "270"
            - name: SpacesInternal__2__AutoLog2DB
              value: "true"
            - name: SpacesInternal__2__AutoLog2DBLogLevel
              value: Notice
            - name: SpacesInternal__3__Id
              value: staging
            - name: SpacesInternal__3__DotStatSuiteCoreStructDbConnectionString
              value: Server= ;Database=$(STAGING_STRUCTURE_DB);User=$(STAGING_STRUCTURE_USER);Password=$(STAGING_STRUCTURE_PASSWORD);
            - name: SpacesInternal__3__DotStatSuiteCoreDataDbConnectionString
              value: Server= ;Database=$(STAGING_DATA_DB);User=$(STAGING_DATA_USER);Password=$(STAGING_DATA_PASSWORD);
            - name: SpacesInternal__3__DataImportTimeOutInMinutes
              value: "5"
            - name: SpacesInternal__3__DatabaseCommandTimeoutInSec
              value: "270"
            - name: SpacesInternal__3__AutoLog2DB
              value: "true"
            - name: SpacesInternal__3__AutoLog2DBLogLevel
              value: Notice
          ports:
            - name: http
              containerPort: 80
              protocol: TCP
          livenessProbe:
            httpGet:
              path: /live
              port: http
          readinessProbe:
            httpGet:
              path: /health
              port: http
          resources:
            seccompProfile:
              type: RuntimeDefault
      initContainers:
        - name: dbup-release-name-fdi-dotstatsuite-stable-data
          image: siscc/dotstatsuite-dbup:master
          imagePullPolicy: Always
          envFrom:
            - configMapRef:
                name: -mssql
          env:
            - name: SA_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: -db-secret
                  key: sapassword
            - name: PASSWORD
              valueFrom:
                secretKeyRef:
                  name: -mssql-sdmx-stable-data
                  key: password
            - name: READ_ONLY_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: -mssql-read-only
                  key: password
          command:
            - bash
            - -c
          args:
            - dotnet DotStat.DbUp.dll upgrade --connectionString "Server= ;Database=$(STABLE_DATA_DB);User=$(SA_USER);Password=$(SA_PASSWORD);" --dataDb --loginName $(STABLE_DATA_USER) --loginPwd $(PASSWORD) --force --alterPassword --ROloginName ${READ_ONLY_USER} --ROloginPwd ${READ_ONLY_PASSWORD}
        - name: dbup-release-name-fdi-dotstatsuite-reset-data
          image: siscc/dotstatsuite-dbup:master
          imagePullPolicy: Always
          envFrom:
            - configMapRef:
                name: -mssql
          env:
            - name: SA_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: -db-secret
                  key: sapassword
            - name: PASSWORD
              valueFrom:
                secretKeyRef:
                  name: -mssql-sdmx-reset-data
                  key: password
            - name: READ_ONLY_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: -mssql-read-only
                  key: password
          command:
            - bash
            - -c
          args:
            - dotnet DotStat.DbUp.dll upgrade --connectionString "Server= ;Database=$(RESET_DATA_DB);User=$(SA_USER);Password=$(SA_PASSWORD);" --dataDb --loginName $(RESET_DATA_USER) --loginPwd $(PASSWORD) --force --dropDb --alterPassword --ROloginName ${READ_ONLY_USER} --ROloginPwd ${READ_ONLY_PASSWORD}
        - name: dbup-release-name-fdi-dotstatsuite-design-data
          image: siscc/dotstatsuite-dbup:master
          imagePullPolicy: Always
          envFrom:
            - configMapRef:
                name: -mssql
          env:
            - name: SA_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: -db-secret
                  key: sapassword
            - name: PASSWORD
              valueFrom:
                secretKeyRef:
                  name: -mssql-sdmx-design-data
                  key: password
            - name: READ_ONLY_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: -mssql-read-only
                  key: password
          command:
            - bash
            - -c
          args:
            - dotnet DotStat.DbUp.dll upgrade --connectionString "Server= ;Database=$(DESIGN_DATA_DB);User=$(SA_USER);Password=$(SA_PASSWORD);" --dataDb --loginName $(DESIGN_DATA_USER) --loginPwd $(PASSWORD) --force --alterPassword --ROloginName ${READ_ONLY_USER} --ROloginPwd ${READ_ONLY_PASSWORD}
        - name: dbup-release-name-fdi-dotstatsuite-staging-data
          image: siscc/dotstatsuite-dbup:master
          imagePullPolicy: Always
          envFrom:
            - configMapRef:
                name: -mssql
          env:
            - name: SA_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: -db-secret
                  key: sapassword
            - name: PASSWORD
              valueFrom:
                secretKeyRef:
                  name: -mssql-sdmx-staging-data
                  key: password
            - name: READ_ONLY_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: -mssql-read-only
                  key: password
          command:
            - bash
            - -c
          args:
            - dotnet DotStat.DbUp.dll upgrade --connectionString "Server= ;Database=$(STAGING_DATA_DB);User=$(SA_USER);Password=$(SA_PASSWORD);" --dataDb --loginName $(STAGING_DATA_USER) --loginPwd $(PASSWORD) --force --alterPassword --ROloginName ${READ_ONLY_USER} --ROloginPwd ${READ_ONLY_PASSWORD}
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: release-name-fdi-dotstatsuite-authz
  labels:
    helm.sh/chart: fdi-dotstatsuite-0.2.14
    app.kubernetes.io/name: fdi-dotstatsuite
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: 7.2.0
    app.kubernetes.io/managed-by: Helm-authz
  annotations:
    kubernetes.io/ingress.class: istio
spec:
  rules:
    - host: authz-siscc.redpelicans.com
      http:
        paths:
          - path: /*
            pathType: ImplementationSpecific
            backend:
              service:
                name: release-name-fdi-dotstatsuite-authz
                port:
                  number: 80
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: release-name-fdi-dotstatsuite-design
  labels:
    helm.sh/chart: fdi-dotstatsuite-0.2.14
    app.kubernetes.io/name: fdi-dotstatsuite
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: 7.2.0
    app.kubernetes.io/managed-by: Helm-design
  annotations:
    kubernetes.io/ingress.class: istio
spec:
  rules:
    - host: fdi-design-ccei.redpelicans.com
      http:
        paths:
          - path: /*
            pathType: ImplementationSpecific
            backend:
              service:
                name: release-name-fdi-dotstatsuite-design
                port:
                  number: 80
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: release-name-fdi-dotstatsuite-reset
  labels:
    helm.sh/chart: fdi-dotstatsuite-0.2.14
    app.kubernetes.io/name: fdi-dotstatsuite
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: 7.2.0
    app.kubernetes.io/managed-by: Helm-reset
  annotations:
    kubernetes.io/ingress.class: istio
spec:
  rules:
    - host: fdi-reset-ccei.redpelicans.com
      http:
        paths:
          - path: /*
            pathType: ImplementationSpecific
            backend:
              service:
                name: release-name-fdi-dotstatsuite-reset
                port:
                  number: 80
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: release-name-fdi-dotstatsuite-stable
  labels:
    helm.sh/chart: fdi-dotstatsuite-0.2.14
    app.kubernetes.io/name: fdi-dotstatsuite
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: 7.2.0
    app.kubernetes.io/managed-by: Helm-stable
  annotations:
    kubernetes.io/ingress.class: istio
spec:
  rules:
    - host: fdi-stable-ccei.redpelicans.com
      http:
        paths:
          - path: /*
            pathType: ImplementationSpecific
            backend:
              service:
                name: release-name-fdi-dotstatsuite-stable
                port:
                  number: 80
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: release-name-fdi-dotstatsuite-staging
  labels:
    helm.sh/chart: fdi-dotstatsuite-0.2.14
    app.kubernetes.io/name: fdi-dotstatsuite
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: 7.2.0
    app.kubernetes.io/managed-by: Helm-staging
  annotations:
    kubernetes.io/ingress.class: istio
spec:
  rules:
    - host: fdi-staging-ccei.redpelicans.com
      http:
        paths:
          - path: /*
            pathType: ImplementationSpecific
            backend:
              service:
                name: release-name-fdi-dotstatsuite-staging
                port:
                  number: 80
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: release-name-fdi-dotstatsuite-transfer
  labels:
    helm.sh/chart: fdi-dotstatsuite-0.2.14
    app.kubernetes.io/name: fdi-dotstatsuite
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: 7.2.0
    app.kubernetes.io/managed-by: Helm-transfer
  annotations:
    kubernetes.io/ingress.class: istio
spec:
  rules:
    - host: fdi-transfer-sdmx.redpelicans.com
      http:
        paths:
          - path: /*
            pathType: ImplementationSpecific
            backend:
              service:
                name: release-name-fdi-dotstatsuite-transfer
                port:
                  number: 80
