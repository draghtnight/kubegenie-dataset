apiVersion: v1
kind: ServiceAccount
metadata:
  name: release-name-keycloa
  namespace: lhb0OLNwy27OOiM
  labels:
    app.kubernetes.io/name: keycloak
    helm.sh/chart: keycloak-2.1.1
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: keycloak
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: release-name-dotstatsuite-authz
  labels:
    helm.sh/chart: dotstatsuite-0.2.8
    app.kubernetes.io/name: dotstatsuite
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: 1.16.0
    app.kubernetes.io/managed-by: Helm-authz
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: release-name-dotstatsuite-nsi-design-oecd
  labels:
    helm.sh/chart: dotstatsuite-0.2.8
    app.kubernetes.io/name: dotstatsuite
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: 1.16.0
    app.kubernetes.io/managed-by: Helm-nsi-design-oecd
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: release-name-dotstatsuite-nsi-reset-siscc
  labels:
    helm.sh/chart: dotstatsuite-0.2.8
    app.kubernetes.io/name: dotstatsuite
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: 1.16.0
    app.kubernetes.io/managed-by: Helm-nsi-reset-siscc
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: release-name-dotstatsuite-nsi-stable-siscc
  labels:
    helm.sh/chart: dotstatsuite-0.2.8
    app.kubernetes.io/name: dotstatsuite
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: 1.16.0
    app.kubernetes.io/managed-by: Helm-nsi-stable-siscc
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: release-name-dotstatsuite-nsi-staging-oecd
  labels:
    helm.sh/chart: dotstatsuite-0.2.8
    app.kubernetes.io/name: dotstatsuite
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: 1.16.0
    app.kubernetes.io/managed-by: Helm-nsi-staging-oecd
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: release-name-dotstatsuite-transfer
  labels:
    helm.sh/chart: dotstatsuite-0.2.8
    app.kubernetes.io/name: dotstatsuite
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: 1.16.0
    app.kubernetes.io/managed-by: Helm-transfer
---
apiVersion: v1
kind: Secret
metadata:
  name: release-name-postgresql
  labels:
    app.kubernetes.io/name: postgresql
    helm.sh/chart: postgresql-10.3.2
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
  namespace: lhb0OLNwy27OOiM
type: Opaque
data:
  postgresql-postgres-password: S3dvQ0l0V2tUSQ==
  postgresql-password: c29tZS1wYXNzd29yZA==
---
apiVersion: v1
kind: Secret
metadata:
  name: release-name-keycloak
  namespace: lhb0OLNwy27OOiM
  labels:
    app.kubernetes.io/name: keycloak
    helm.sh/chart: keycloak-2.1.1
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: keycloak
type: Opaque
data:
  admin-password: SFh4NXg0TjRaUw==
  management-password: TlRiZTJJR1Ficg==
  database-password: c29tZS1wYXNzd29yZA==
---
kind: Secret
apiVersion: v1
metadata:
  name: dotstatsuite-db-secret
data:
  sapassword: null
type: Opaque
---
kind: Secret
apiVersion: v1
metadata:
  name: mssql-common
data:
  password: null
type: Opaque
---
kind: Secret
apiVersion: v1
metadata:
  name: mssql-nsi-design-oecd-data
data:
  password: null
type: Opaque
---
kind: Secret
apiVersion: v1
metadata:
  name: mssql-nsi-design-oecd-structure
data:
  password: null
type: Opaque
---
kind: Secret
apiVersion: v1
metadata:
  name: mssql-nsi-reset-siscc-data
data:
  password: null
type: Opaque
---
kind: Secret
apiVersion: v1
metadata:
  name: mssql-nsi-reset-siscc-structure
data:
  password: null
type: Opaque
---
kind: Secret
apiVersion: v1
metadata:
  name: mssql-nsi-stable-siscc-data
data:
  password: null
type: Opaque
---
kind: Secret
apiVersion: v1
metadata:
  name: mssql-nsi-stable-siscc-structure
data:
  password: null
type: Opaque
---
kind: Secret
apiVersion: v1
metadata:
  name: mssql-nsi-staging-oecd-data
data:
  password: null
type: Opaque
---
kind: Secret
apiVersion: v1
metadata:
  name: mssql-nsi-staging-oecd-structure
data:
  password: null
type: Opaque
---
kind: Secret
apiVersion: v1
metadata:
  name: smtp
data:
  password: null
type: Opaque
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: release-name-keycloa-env-vars
  namespace: lhb0OLNwy27OOiM
  labels:
    app.kubernetes.io/name: keycloak
    helm.sh/chart: keycloak-2.1.1
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: keycloak
data:
  KEYCLOAK_CREATE_ADMIN_USER: "true"
  KEYCLOAK_ADMIN_USER: user
  KEYCLOAK_MANAGEMENT_USER: manager
  KEYCLOAK_DATABASE_HOST: release-name-postgresql
  KEYCLOAK_DATABASE_PORT: "5432"
  KEYCLOAK_DATABASE_NAME: bitnami_keycloak
  KEYCLOAK_DATABASE_USER: bn_keycloak
  KEYCLOAK_HTTP_PORT: "8080"
  KEYCLOAK_PROXY_ADDRESS_FORWARDING: "false"
  KEYCLOAK_ENABLE_STATISTICS: "false"
  KEYCLOAK_CACHE_OWNERS_COUNT: "1"
  KEYCLOAK_AUTH_CACHE_OWNERS_COUNT: "1"
  KEYCLOAK_ENABLE_TLS: "false"
---
kind: ConfigMap
apiVersion: v1
metadata:
  name: authz
data:
  auth__allowAnonymous: "true"
  auth__authority: ""
  auth__authorizationUrl: ""
  auth__claimsMapping__email: email
  auth__claimsMapping__groups: roles
  auth__clientId: ""
  auth__enabled: "true"
  auth__requireHttps: "false"
  auth__scopes__0: openid
  auth__scopes__1: profile
  auth__scopes__2: email
  auth__validateIssuer: "false"
  auth__showPii: "true"
---
kind: ConfigMap
apiVersion: v1
metadata:
  name: mssql
data:
  COMMON_DB: commonDb
  COMMON_USER: commonUser
  NSI_DESIGN_OECD_DATA_DB: nsiDesignOecdDataDb
  NSI_DESIGN_OECD_DATA_USER: nsiDesignOecdDataUser
  NSI_DESIGN_OECD_STRUCTURE_DB: nsiDesignOecdStructureDb
  NSI_DESIGN_OECD_STRUCTURE_USER: nsiDesignOecdStructureUser
  NSI_RESET_SISCC_DATA_DB: nsiResetSisccDataDb
  NSI_RESET_SISCC_DATA_USER: nsiResetSisccDataUser
  NSI_RESET_SISCC_STRUCTURE_DB: nsiResetSisccStructureDb
  NSI_RESET_SISCC_STRUCTURE_USER: nsiResetSisccStructureUser
  NSI_STABLE_SISCC_DATA_DB: nsiStableSisccDataDb
  NSI_STABLE_SISCC_DATA_USER: nsiStableSisccDataUser
  NSI_STABLE_SISCC_STRUCTURE_DB: nsiStableSisccStructureDb
  NSI_STABLE_SISCC_STRUCTURE_USER: nsiStableSisccStructureUser
  NSI_STAGING_OECD_DATA_DB: nsiStagingOecdDataDb
  NSI_STAGING_OECD_DATA_USER: nsiStagingOecdDataUser
  NSI_STAGING_OECD_STRUCTURE_DB: nsiStagingOecdStructureDb
  NSI_STAGING_OECD_STRUCTURE_USER: nsiStagingOecdStructureUser
  SA_USER: sqlhstsvc
---
apiVersion: v1
kind: Service
metadata:
  name: release-name-postgresql-headless
  labels:
    app.kubernetes.io/name: postgresql
    helm.sh/chart: postgresql-10.3.2
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
    service.alpha.kubernetes.io/tolerate-unready-endpoints: "true"
  namespace: lhb0OLNwy27OOiM
spec:
  type: ClusterIP
  clusterIP: None
  publishNotReadyAddresses: true
  ports:
    - name: tcp-postgresql
      port: 5432
      targetPort: tcp-postgresql
  selector:
    app.kubernetes.io/name: postgresql
    app.kubernetes.io/instance: release-name
---
apiVersion: v1
kind: Service
metadata:
  name: release-name-postgresql
  labels:
    app.kubernetes.io/name: postgresql
    helm.sh/chart: postgresql-10.3.2
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
  annotations: null
  namespace: lhb0OLNwy27OOiM
spec:
  type: ClusterIP
  ports:
    - name: tcp-postgresql
      port: 5432
      targetPort: tcp-postgresql
  selector:
    app.kubernetes.io/name: postgresql
    app.kubernetes.io/instance: release-name
    role: primary
---
apiVersion: v1
kind: Service
metadata:
  name: release-name-keycloa-headless
  namespace: lhb0OLNwy27OOiM
  labels:
    app.kubernetes.io/name: keycloak
    helm.sh/chart: keycloak-2.1.1
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: keycloak
spec:
  type: ClusterIP
  clusterIP: None
  ports:
    - name: http
      port: 80
      protocol: TCP
      targetPort: http
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/name: keycloak
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/component: keycloak
---
apiVersion: v1
kind: Service
metadata:
  name: release-name-keycloa
  namespace: lhb0OLNwy27OOiM
  labels:
    app.kubernetes.io/name: keycloak
    helm.sh/chart: keycloak-2.1.1
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: keycloak
spec:
  type: LoadBalancer
  externalTrafficPolicy: Cluster
  loadBalancerSourceRanges: []
  ports:
    - name: http
      port: 80
      protocol: TCP
      targetPort: http
    - name: https
      port: 443
      protocol: TCP
      targetPort: https
  selector:
    app.kubernetes.io/name: keycloak
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/component: keycloak
---
apiVersion: v1
kind: Service
metadata:
  name: release-name-dotstatsuite-authz
  labels:
    helm.sh/chart: dotstatsuite-0.2.8
    app.kubernetes.io/name: dotstatsuite
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: 1.16.0
    app.kubernetes.io/managed-by: Helm-authz
spec:
  type: ClusterIP
  ports:
    - port: 80
      targetPort: http
      protocol: TCP
      name: http-authz
  selector:
    app.kubernetes.io/name: dotstatsuite
    app.kubernetes.io/instance: release-name-authz
---
apiVersion: v1
kind: Service
metadata:
  name: release-name-dotstatsuite-nsi-design-oecd
  labels:
    helm.sh/chart: dotstatsuite-0.2.8
    app.kubernetes.io/name: dotstatsuite
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: 1.16.0
    app.kubernetes.io/managed-by: Helm-nsi-design-oecd
spec:
  type: ClusterIP
  ports:
    - port: 80
      targetPort: http
      protocol: TCP
      name: http-nsi-design-oecd
  selector:
    app.kubernetes.io/name: dotstatsuite
    app.kubernetes.io/instance: release-name-nsi-design-oecd
---
apiVersion: v1
kind: Service
metadata:
  name: release-name-dotstatsuite-nsi-reset-siscc
  labels:
    helm.sh/chart: dotstatsuite-0.2.8
    app.kubernetes.io/name: dotstatsuite
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: 1.16.0
    app.kubernetes.io/managed-by: Helm-nsi-reset-siscc
spec:
  type: ClusterIP
  ports:
    - port: 80
      targetPort: http
      protocol: TCP
      name: http-nsi-reset-siscc
  selector:
    app.kubernetes.io/name: dotstatsuite
    app.kubernetes.io/instance: release-name-nsi-reset-siscc
---
apiVersion: v1
kind: Service
metadata:
  name: release-name-dotstatsuite-nsi-stable-siscc
  labels:
    helm.sh/chart: dotstatsuite-0.2.8
    app.kubernetes.io/name: dotstatsuite
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: 1.16.0
    app.kubernetes.io/managed-by: Helm-nsi-stable-siscc
spec:
  type: ClusterIP
  ports:
    - port: 80
      targetPort: http
      protocol: TCP
      name: http-nsi-stable-siscc
  selector:
    app.kubernetes.io/name: dotstatsuite
    app.kubernetes.io/instance: release-name-nsi-stable-siscc
---
apiVersion: v1
kind: Service
metadata:
  name: release-name-dotstatsuite-nsi-staging-oecd
  labels:
    helm.sh/chart: dotstatsuite-0.2.8
    app.kubernetes.io/name: dotstatsuite
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: 1.16.0
    app.kubernetes.io/managed-by: Helm-nsi-staging-oecd
spec:
  type: ClusterIP
  ports:
    - port: 80
      targetPort: http
      protocol: TCP
      name: http-nsi-staging-oecd
  selector:
    app.kubernetes.io/name: dotstatsuite
    app.kubernetes.io/instance: release-name-nsi-staging-oecd
---
apiVersion: v1
kind: Service
metadata:
  name: release-name-dotstatsuite-transfer
  labels:
    helm.sh/chart: dotstatsuite-0.2.8
    app.kubernetes.io/name: dotstatsuite
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: 1.16.0
    app.kubernetes.io/managed-by: Helm-transfer
spec:
  type: ClusterIP
  ports:
    - port: 80
      targetPort: http
      protocol: TCP
      name: http-transfer
  selector:
    app.kubernetes.io/name: dotstatsuite
    app.kubernetes.io/instance: release-name-transfer
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: release-name-dotstatsuite-authz
  labels:
    helm.sh/chart: dotstatsuite-0.2.8
    app.kubernetes.io/name: dotstatsuite
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: 1.16.0
    app.kubernetes.io/managed-by: Helm-authz
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: dotstatsuite
      app.kubernetes.io/instance: release-name-authz
  template:
    metadata:
      annotations:
        traffic.sidecar.istio.io/excludeOutboundPorts: "1433"
      labels:
        app.kubernetes.io/name: dotstatsuite
        app.kubernetes.io/instance: release-name-authz
    spec:
      imagePullSecrets:
        - name: registry-pull-secret
      serviceAccountName: release-name-dotstatsuite-authz
      securityContext: {}
      containers:
        - name: dotstatsuite-authz
          securityContext:
            allowPrivilegeEscalation: false
            capabilities:
              drop:
                "": NET_RAW
            readOnlyRootFilesystem: true
          image: siscc/dotstatsuite-core-auth-management:9a653e82
          imagePullPolicy: IfNotPresent
          envFrom:
            - configMapRef:
                name: mssql
            - configMapRef:
                name: authz
          env:
            - name: COMMON_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: mssql-common
                  key: password
            - name: DotStatSuiteCoreCommonDbConnectionString
              value: Server=dotstatsuite.database.windows.net;Database=$(COMMON_DB);User=$(COMMON_USER);Password=$(COMMON_PASSWORD);
          ports:
            - name: http
              containerPort: 80
              protocol: TCP
          livenessProbe:
            httpGet:
              path: /live
              port: http
          readinessProbe:
            httpGet:
              path: /health
              port: http
          resources:
            seccompProfile:
              type: RuntimeDefault
      initContainers:
        - name: dotstatsuite-dbup-common
          image: siscc/dotstatsuite-dbup:master
          imagePullPolicy: Always
          envFrom:
            - configMapRef:
                name: mssql
          env:
            - name: SA_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: dotstatsuite-db-secret
                  key: sapassword
            - name: COMMON_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: mssql-common
                  key: password
          command:
            - bash
            - -c
          args:
            - dotnet DotStat.DbUp.dll upgrade --connectionString "Server=dotstatsuite.database.windows.net;Database=$(COMMON_DB);User=$(SA_USER);Password=$(SA_PASSWORD);" --commonDb --loginName $(COMMON_USER) --loginPwd $(COMMON_PASSWORD) --force
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: release-name-dotstatsuite-nsi-design-oecd
  labels:
    helm.sh/chart: dotstatsuite-0.2.8
    app.kubernetes.io/name: dotstatsuite
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: 1.16.0
    app.kubernetes.io/managed-by: Helm-nsi-design-oecd
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: dotstatsuite
      app.kubernetes.io/instance: release-name-nsi-design-oecd
  template:
    metadata:
      annotations:
        traffic.sidecar.istio.io/excludeOutboundPorts: "1433"
      labels:
        app.kubernetes.io/name: dotstatsuite
        app.kubernetes.io/instance: release-name-nsi-design-oecd
    spec:
      imagePullSecrets:
        - name: registry-pull-secret
      serviceAccountName: release-name-dotstatsuite-nsi-design-oecd
      securityContext: {}
      containers:
        - name: dotstatsuite-nsi-design-oecd
          securityContext:
            allowPrivilegeEscalation: false
            capabilities:
              drop:
                "": NET_RAW
            readOnlyRootFilesystem: true
          image: siscc/dotstatsuite-core-sdmxri-nsi:master
          imagePullPolicy: IfNotPresent
          envFrom:
            - configMapRef:
                name: mssql
            - configMapRef:
                name: authz
          env:
            - name: SA_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: dotstatsuite-db-secret
                  key: sapassword
            - name: DESIGN_DATA_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: mssql-nsi-design-oecd-data
                  key: password
            - name: DESIGN_STRUCTURE_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: mssql-nsi-design-oecd-structure
                  key: password
            - name: COMMON_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: mssql-common
                  key: password
            - name: DotStatSuiteCoreCommonDbConnectionString
              value: Server=dotstatsuite.database.windows.net;Database=$(COMMON_DB);User=$(COMMON_USER);Password=$(COMMON_PASSWORD);
            - name: SpacesInternal__0__Id
              value: OECD-design
            - name: SpacesInternal__0__DotStatSuiteCoreStructDbConnectionString
              value: Server=dotstatsuite.database.windows.net;Database=$(NSI_DESIGN_OECD_STRUCTURE_DB);User=$(NSI_DESIGN_OECD_STRUCTURE_USER);Password=$(DESIGN_STRUCTURE_PASSWORD);
            - name: SpacesInternal__0__DotStatSuiteCoreDataDbConnectionString
              value: Server=dotstatsuite.database.windows.net;Database=$(NSI_DESIGN_OECD_DATA_DB);User=$(NSI_DESIGN_OECD_DATA_USER);Password=$(DESIGN_DATA_PASSWORD);
            - name: SpacesInternal__0__DataImportTimeOutInMinutes
              value: "2"
            - name: SpacesInternal__0__DatabaseCommandTimeoutInSec
              value: "60"
            - name: SpacesInternal__0__AuthEndpoint
              value: dotstatsuite-authz
            - name: SpacesInternal__0__AutoLog2DB
              value: "true"
            - name: SpacesInternal__0__AutoLog2DBLogLevel
              value: Notice
            - name: SQL_SERVER
              value: dotstatsuite.database.windows.net
            - name: SQL_DATABASE
              value: $(NSI_DESIGN_OECD_STRUCTURE_DB)
            - name: SQL_USER
              value: $(NSI_DESIGN_OECD_STRUCTURE_USER)
            - name: SQL_PASSWORD
              value: $(DESIGN_STRUCTURE_PASSWORD)
            - name: SENDER_ID
              value: Stable - DotStat v8
            - name: DATASPACE_ID
              value: OECD-design
            - name: MA_SQL_USER
              value: $(SA_USER)
            - name: MA_SQL_PASSWORD
              value: $(SA_PASSWORD)
            - name: MA_ALWAYS_RESET
              value: "N"
            - name: INSERT_NEW_ITEM_SCHEME_VALUES
              value: "true"
          ports:
            - name: http
              containerPort: 80
              protocol: TCP
          readinessProbe:
            httpGet:
              path: /health
              port: http
          resources:
            seccompProfile:
              type: RuntimeDefault
      initContainers:
        - name: dotstatsuite-dbup-design-structure
          image: siscc/dotstatsuite-dbup:master
          imagePullPolicy: Always
          envFrom:
            - configMapRef:
                name: mssql
          env:
            - name: SA_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: dotstatsuite-db-secret
                  key: sapassword
            - name: DESIGN_STRUCTURE_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: mssql-nsi-design-oecd-structure
                  key: password
          command:
            - bash
            - -c
          args:
            - dotnet DotStat.DbUp.dll upgrade --connectionString "Server=dotstatsuite.database.windows.net;Database=$(NSI_DESIGN_OECD_STRUCTURE_DB);User=$(SA_USER);Password=$(SA_PASSWORD);" --mappingStoreDb --loginName $(NSI_DESIGN_OECD_STRUCTURE_USER) --loginPwd $(DESIGN_STRUCTURE_PASSWORD) --force
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: release-name-dotstatsuite-nsi-reset-siscc
  labels:
    helm.sh/chart: dotstatsuite-0.2.8
    app.kubernetes.io/name: dotstatsuite
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: 1.16.0
    app.kubernetes.io/managed-by: Helm-nsi-reset-siscc
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: dotstatsuite
      app.kubernetes.io/instance: release-name-nsi-reset-siscc
  template:
    metadata:
      annotations:
        traffic.sidecar.istio.io/excludeOutboundPorts: "1433"
      labels:
        app.kubernetes.io/name: dotstatsuite
        app.kubernetes.io/instance: release-name-nsi-reset-siscc
    spec:
      imagePullSecrets:
        - name: registry-pull-secret
      serviceAccountName: release-name-dotstatsuite-nsi-reset-siscc
      securityContext: {}
      containers:
        - name: dotstatsuite-nsi-reset-siscc
          securityContext:
            allowPrivilegeEscalation: false
            capabilities:
              drop:
                "": NET_RAW
            readOnlyRootFilesystem: true
          image: siscc/dotstatsuite-core-sdmxri-nsi:master
          imagePullPolicy: IfNotPresent
          envFrom:
            - configMapRef:
                name: mssql
            - configMapRef:
                name: authz
          env:
            - name: SA_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: dotstatsuite-db-secret
                  key: sapassword
            - name: RESET_DATA_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: mssql-nsi-reset-siscc-data
                  key: password
            - name: RESET_STRUCTURE_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: mssql-nsi-reset-siscc-structure
                  key: password
            - name: COMMON_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: mssql-common
                  key: password
            - name: DotStatSuiteCoreCommonDbConnectionString
              value: Server=dotstatsuite.database.windows.net;Database=$(COMMON_DB);User=$(COMMON_USER);Password=$(COMMON_PASSWORD);
            - name: SpacesInternal__0__Id
              value: staging:SIS-CC-reset
            - name: SpacesInternal__0__DotStatSuiteCoreStructDbConnectionString
              value: Server=dotstatsuite.database.windows.net;Database=$(NSI_RESET_SISCC_STRUCTURE_DB);User=$(NSI_RESET_SISCC_STRUCTURE_USER);Password=$(RESET_STRUCTURE_PASSWORD);
            - name: SpacesInternal__0__DotStatSuiteCoreDataDbConnectionString
              value: Server=dotstatsuite.database.windows.net;Database=$(NSI_RESET_SISCC_DATA_DB);User=$(NSI_RESET_SISCC_DATA_USER);Password=$(RESET_DATA_PASSWORD);
            - name: SpacesInternal__0__DataImportTimeOutInMinutes
              value: "2"
            - name: SpacesInternal__0__DatabaseCommandTimeoutInSec
              value: "60"
            - name: SpacesInternal__0__AuthEndpoint
              value: dotstatsuite-authz
            - name: SpacesInternal__0__AutoLog2DB
              value: "true"
            - name: SpacesInternal__0__AutoLog2DBLogLevel
              value: Notice
            - name: SQL_SERVER
              value: dotstatsuite.database.windows.net
            - name: SQL_DATABASE
              value: $(NSI_RESET_SISCC_STRUCTURE_DB)
            - name: SQL_USER
              value: $(NSI_RESET_SISCC_STRUCTURE_USER)
            - name: SQL_PASSWORD
              value: $(RESET_STRUCTURE_PASSWORD)
            - name: SENDER_ID
              value: Stable - DotStat v8
            - name: DATASPACE_ID
              value: staging:SIS-CC-reset
            - name: MA_SQL_USER
              value: $(SA_USER)
            - name: MA_SQL_PASSWORD
              value: $(SA_PASSWORD)
            - name: MA_ALWAYS_RESET
              value: "Y"
            - name: INSERT_NEW_ITEM_SCHEME_VALUES
              value: "true"
          ports:
            - name: http
              containerPort: 80
              protocol: TCP
          readinessProbe:
            httpGet:
              path: /health
              port: http
          resources:
            seccompProfile:
              type: RuntimeDefault
      initContainers:
        - name: dotstatsuite-dbup-reset-structure
          image: siscc/dotstatsuite-dbup:master
          imagePullPolicy: Always
          envFrom:
            - configMapRef:
                name: mssql
          env:
            - name: SA_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: dotstatsuite-db-secret
                  key: sapassword
            - name: RESET_STRUCTURE_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: mssql-nsi-reset-siscc-structure
                  key: password
          command:
            - bash
            - -c
          args:
            - dotnet DotStat.DbUp.dll upgrade --connectionString "Server=dotstatsuite.database.windows.net;Database=$(NSI_RESET_SISCC_STRUCTURE_DB);User=$(SA_USER);Password=$(SA_PASSWORD);" --mappingStoreDb --loginName $(NSI_RESET_SISCC_STRUCTURE_USER) --loginPwd $(RESET_STRUCTURE_PASSWORD) --force --dropDb
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: release-name-dotstatsuite-nsi-stable-siscc
  labels:
    helm.sh/chart: dotstatsuite-0.2.8
    app.kubernetes.io/name: dotstatsuite
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: 1.16.0
    app.kubernetes.io/managed-by: Helm-nsi-stable-siscc
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: dotstatsuite
      app.kubernetes.io/instance: release-name-nsi-stable-siscc
  template:
    metadata:
      annotations:
        traffic.sidecar.istio.io/excludeOutboundPorts: "1433"
      labels:
        app.kubernetes.io/name: dotstatsuite
        app.kubernetes.io/instance: release-name-nsi-stable-siscc
    spec:
      imagePullSecrets:
        - name: registry-pull-secret
      serviceAccountName: release-name-dotstatsuite-nsi-stable-siscc
      securityContext: {}
      containers:
        - name: dotstatsuite-nsi-stable-siscc
          securityContext:
            allowPrivilegeEscalation: false
            capabilities:
              drop:
                "": NET_RAW
            readOnlyRootFilesystem: true
          image: siscc/dotstatsuite-core-sdmxri-nsi:master
          imagePullPolicy: IfNotPresent
          envFrom:
            - configMapRef:
                name: mssql
            - configMapRef:
                name: authz
          env:
            - name: SA_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: dotstatsuite-db-secret
                  key: sapassword
            - name: STABLE_DATA_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: mssql-nsi-stable-siscc-data
                  key: password
            - name: STABLE_STRUCTURE_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: mssql-nsi-stable-siscc-structure
                  key: password
            - name: COMMON_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: mssql-common
                  key: password
            - name: DotStatSuiteCoreCommonDbConnectionString
              value: Server=dotstatsuite.database.windows.net;Database=$(COMMON_DB);User=$(COMMON_USER);Password=$(COMMON_PASSWORD);
            - name: SpacesInternal__0__Id
              value: staging:SIS-CC-stable
            - name: SpacesInternal__0__DotStatSuiteCoreStructDbConnectionString
              value: Server=dotstatsuite.database.windows.net;Database=$(NSI_STABLE_SISCC_STRUCTURE_DB);User=$(NSI_STABLE_SISCC_STRUCTURE_USER);Password=$(STABLE_STRUCTURE_PASSWORD);
            - name: SpacesInternal__0__DotStatSuiteCoreDataDbConnectionString
              value: Server=dotstatsuite.database.windows.net;Database=$(NSI_STABLE_SISCC_DATA_DB);User=$(NSI_STABLE_SISCC_DATA_USER);Password=$(STABLE_DATA_PASSWORD);
            - name: SpacesInternal__0__DataImportTimeOutInMinutes
              value: "2"
            - name: SpacesInternal__0__DatabaseCommandTimeoutInSec
              value: "60"
            - name: SpacesInternal__0__AuthEndpoint
              value: dotstatsuite-authz
            - name: SpacesInternal__0__AutoLog2DB
              value: "true"
            - name: SpacesInternal__0__AutoLog2DBLogLevel
              value: Notice
            - name: SQL_SERVER
              value: dotstatsuite.database.windows.net
            - name: SQL_DATABASE
              value: $(NSI_STABLE_SISCC_STRUCTURE_DB)
            - name: SQL_USER
              value: $(NSI_STABLE_SISCC_STRUCTURE_USER)
            - name: SQL_PASSWORD
              value: $(STABLE_STRUCTURE_PASSWORD)
            - name: SENDER_ID
              value: Stable - DotStat v8
            - name: DATASPACE_ID
              value: staging:SIS-CC-stable
            - name: MA_SQL_USER
              value: $(SA_USER)
            - name: MA_SQL_PASSWORD
              value: $(SA_PASSWORD)
            - name: MA_ALWAYS_RESET
              value: "N"
            - name: INSERT_NEW_ITEM_SCHEME_VALUES
              value: "false"
          ports:
            - name: http
              containerPort: 80
              protocol: TCP
          readinessProbe:
            httpGet:
              path: /health
              port: http
          resources:
            seccompProfile:
              type: RuntimeDefault
      initContainers:
        - name: dotstatsuite-dbup-stable-structure
          image: siscc/dotstatsuite-dbup:master
          imagePullPolicy: Always
          envFrom:
            - configMapRef:
                name: mssql
          env:
            - name: SA_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: dotstatsuite-db-secret
                  key: sapassword
            - name: STABLE_STRUCTURE_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: mssql-nsi-stable-siscc-structure
                  key: password
          command:
            - bash
            - -c
          args:
            - dotnet DotStat.DbUp.dll upgrade --connectionString "Server=dotstatsuite.database.windows.net;Database=$(NSI_STABLE_SISCC_STRUCTURE_DB);User=$(SA_USER);Password=$(SA_PASSWORD);" --mappingStoreDb --loginName $(NSI_STABLE_SISCC_STRUCTURE_USER) --loginPwd $(STABLE_STRUCTURE_PASSWORD) --force
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: release-name-dotstatsuite-nsi-staging-oecd
  labels:
    helm.sh/chart: dotstatsuite-0.2.8
    app.kubernetes.io/name: dotstatsuite
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: 1.16.0
    app.kubernetes.io/managed-by: Helm-nsi-staging-oecd
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: dotstatsuite
      app.kubernetes.io/instance: release-name-nsi-staging-oecd
  template:
    metadata:
      annotations:
        traffic.sidecar.istio.io/excludeOutboundPorts: "1433"
      labels:
        app.kubernetes.io/name: dotstatsuite
        app.kubernetes.io/instance: release-name-nsi-staging-oecd
    spec:
      imagePullSecrets:
        - name: registry-pull-secret
      serviceAccountName: release-name-dotstatsuite-nsi-staging-oecd
      securityContext: {}
      containers:
        - name: dotstatsuite-nsi-staging-oecd
          securityContext:
            allowPrivilegeEscalation: false
            capabilities:
              drop:
                "": NET_RAW
            readOnlyRootFilesystem: true
          image: siscc/dotstatsuite-core-sdmxri-nsi:master
          imagePullPolicy: IfNotPresent
          envFrom:
            - configMapRef:
                name: mssql
            - configMapRef:
                name: authz
          env:
            - name: SA_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: dotstatsuite-db-secret
                  key: sapassword
            - name: STAGING_DATA_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: mssql-nsi-staging-oecd-data
                  key: password
            - name: STAGING_STRUCTURE_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: mssql-nsi-staging-oecd-structure
                  key: password
            - name: COMMON_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: mssql-common
                  key: password
            - name: DotStatSuiteCoreCommonDbConnectionString
              value: Server=dotstatsuite.database.windows.net;Database=$(COMMON_DB);User=$(COMMON_USER);Password=$(COMMON_PASSWORD);
            - name: SpacesInternal__0__Id
              value: OECD-staging
            - name: SpacesInternal__0__DotStatSuiteCoreStructDbConnectionString
              value: Server=dotstatsuite.database.windows.net;Database=$(NSI_STAGING_OECD_STRUCTURE_DB);User=$(NSI_STAGING_OECD_STRUCTURE_USER);Password=$(STAGING_STRUCTURE_PASSWORD);
            - name: SpacesInternal__0__DotStatSuiteCoreDataDbConnectionString
              value: Server=dotstatsuite.database.windows.net;Database=$(NSI_STAGING_OECD_DATA_DB);User=$(NSI_STAGING_OECD_DATA_USER);Password=$(STAGING_DATA_PASSWORD);
            - name: SpacesInternal__0__DataImportTimeOutInMinutes
              value: "2"
            - name: SpacesInternal__0__DatabaseCommandTimeoutInSec
              value: "60"
            - name: SpacesInternal__0__AuthEndpoint
              value: dotstatsuite-authz
            - name: SpacesInternal__0__AutoLog2DB
              value: "true"
            - name: SpacesInternal__0__AutoLog2DBLogLevel
              value: Notice
            - name: SQL_SERVER
              value: dotstatsuite.database.windows.net
            - name: SQL_DATABASE
              value: $(NSI_STAGING_OECD_STRUCTURE_DB)
            - name: SQL_USER
              value: $(NSI_STAGING_OECD_STRUCTURE_USER)
            - name: SQL_PASSWORD
              value: $(STAGING_STRUCTURE_PASSWORD)
            - name: SENDER_ID
              value: Stable - DotStat v8
            - name: DATASPACE_ID
              value: OECD-staging
            - name: MA_SQL_USER
              value: $(SA_USER)
            - name: MA_SQL_PASSWORD
              value: $(SA_PASSWORD)
            - name: MA_ALWAYS_RESET
              value: "N"
            - name: INSERT_NEW_ITEM_SCHEME_VALUES
              value: "false"
          ports:
            - name: http
              containerPort: 80
              protocol: TCP
          readinessProbe:
            httpGet:
              path: /health
              port: http
          resources:
            seccompProfile:
              type: RuntimeDefault
      initContainers:
        - name: dotstatsuite-dbup-staging-structure
          image: siscc/dotstatsuite-dbup:master
          imagePullPolicy: Always
          envFrom:
            - configMapRef:
                name: mssql
          env:
            - name: SA_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: dotstatsuite-db-secret
                  key: sapassword
            - name: STAGING_STRUCTURE_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: mssql-nsi-staging-oecd-structure
                  key: password
          command:
            - bash
            - -c
          args:
            - dotnet DotStat.DbUp.dll upgrade --connectionString "Server=dotstatsuite.database.windows.net;Database=$(NSI_STAGING_OECD_STRUCTURE_DB);User=$(SA_USER);Password=$(SA_PASSWORD);" --mappingStoreDb --loginName $(NSI_STAGING_OECD_STRUCTURE_USER) --loginPwd $(STAGING_STRUCTURE_PASSWORD) --force
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: release-name-dotstatsuite-transfer
  labels:
    helm.sh/chart: dotstatsuite-0.2.8
    app.kubernetes.io/name: dotstatsuite
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: 1.16.0
    app.kubernetes.io/managed-by: Helm-transfer
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: dotstatsuite
      app.kubernetes.io/instance: release-name-transfer
  template:
    metadata:
      annotations:
        traffic.sidecar.istio.io/excludeOutboundPorts: "1433"
      labels:
        app.kubernetes.io/name: dotstatsuite
        app.kubernetes.io/instance: release-name-transfer
    spec:
      imagePullSecrets:
        - name: registry-pull-secret
      serviceAccountName: release-name-dotstatsuite-transfer
      securityContext: {}
      containers:
        - name: dotstatsuite-transfer
          securityContext:
            allowPrivilegeEscalation: false
            capabilities:
              drop:
                "": NET_RAW
            readOnlyRootFilesystem: true
          image: siscc/dotstatsuite-core-transfer:master
          imagePullPolicy: IfNotPresent
          envFrom:
            - configMapRef:
                name: mssql
            - configMapRef:
                name: authz
          env:
            - name: SA_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: dotstatsuite-db-secret
                  key: sapassword
            - name: COMMON_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: mssql-common
                  key: password
            - name: SMTP_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: smtp
                  key: password
            - name: DESIGN_DATA_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: mssql-nsi-design-oecd-data
                  key: password
            - name: DESIGN_STRUCTURE_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: mssql-nsi-design-oecd-structure
                  key: password
            - name: STAGING_DATA_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: mssql-nsi-staging-oecd-data
                  key: password
            - name: STAGING_STRUCTURE_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: mssql-nsi-staging-oecd-structure
                  key: password
            - name: STABLE_DATA_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: mssql-nsi-stable-siscc-data
                  key: password
            - name: STABLE_STRUCTURE_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: mssql-nsi-stable-siscc-structure
                  key: password
            - name: RESET_DATA_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: mssql-nsi-reset-siscc-data
                  key: password
            - name: RESET_STRUCTURE_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: mssql-nsi-reset-siscc-structure
                  key: password
            - name: MaxTransferErrorAmount
              value: "0"
            - name: MaxTextAttributeLength
              value: "150"
            - name: DefaultLanguageCode
              value: en
            - name: SmtpHost
              value: smtp.sendgrid.net
            - name: SmtpPort
              value: "587"
            - name: SmtpEnableSsl
              value: "true"
            - name: SmtpUserName
              value: admin@example.com
            - name: SmtpUserPassword
              value: $(SMTP_PASSWORD)
            - name: MailFrom
              value: build@siscc.org
            - name: DotStatSuiteCoreCommonDbConnectionString
              value: Server=dotstatsuite.database.windows.net;Database=$(COMMON_DB);User=$(COMMON_USER);Password=$(COMMON_PASSWORD);
            - name: SpacesInternal__0__Id
              value: OECD-design
            - name: SpacesInternal__0__DotStatSuiteCoreStructDbConnectionString
              value: Server=dotstatsuite.database.windows.net;Database=$(NSI_DESIGN_OECD_STRUCTURE_DB);User=$(NSI_DESIGN_OECD_STRUCTURE_USER);Password=$(DESIGN_STRUCTURE_PASSWORD);
            - name: SpacesInternal__0__DotStatSuiteCoreDataDbConnectionString
              value: Server=dotstatsuite.database.windows.net;Database=$(NSI_DESIGN_OECD_DATA_DB);User=$(NSI_DESIGN_OECD_DATA_USER);Password=$(DESIGN_DATA_PASSWORD);
            - name: SpacesInternal__0__DataImportTimeOutInMinutes
              value: "2"
            - name: SpacesInternal__0__DatabaseCommandTimeoutInSec
              value: "60"
            - name: SpacesInternal__0__AutoLog2DB
              value: "true"
            - name: SpacesInternal__0__AutoLog2DBLogLevel
              value: Notice
            - name: SpacesInternal__1__Id
              value: OECD-staging
            - name: SpacesInternal__1__DotStatSuiteCoreStructDbConnectionString
              value: Server=dotstatsuite.database.windows.net;Database=$(NSI_STAGING_OECD_STRUCTURE_DB);User=$(NSI_STAGING_OECD_STRUCTURE_USER);Password=$(STAGING_STRUCTURE_PASSWORD);
            - name: SpacesInternal__1__DotStatSuiteCoreDataDbConnectionString
              value: Server=dotstatsuite.database.windows.net;Database=$(NSI_STAGING_OECD_DATA_DB);User=$(NSI_STAGING_OECD_DATA_USER);Password=$(STAGING_DATA_PASSWORD);
            - name: SpacesInternal__1__DataImportTimeOutInMinutes
              value: "2"
            - name: SpacesInternal__1__DatabaseCommandTimeoutInSec
              value: "60"
            - name: SpacesInternal__1__AutoLog2DB
              value: "true"
            - name: SpacesInternal__1__AutoLog2DBLogLevel
              value: Notice
            - name: SpacesInternal__2__Id
              value: staging:SIS-CC-stable
            - name: SpacesInternal__2__DotStatSuiteCoreStructDbConnectionString
              value: Server=dotstatsuite.database.windows.net;Database=$(NSI_STABLE_SISCC_STRUCTURE_DB);User=$(NSI_STABLE_SISCC_STRUCTURE_USER);Password=$(STABLE_STRUCTURE_PASSWORD);
            - name: SpacesInternal__2__DotStatSuiteCoreDataDbConnectionString
              value: Server=dotstatsuite.database.windows.net;Database=$(NSI_STABLE_SISCC_DATA_DB);User=$(NSI_STABLE_SISCC_DATA_USER);Password=$(STABLE_DATA_PASSWORD);
            - name: SpacesInternal__2__DataImportTimeOutInMinutes
              value: "5"
            - name: SpacesInternal__2__DatabaseCommandTimeoutInSec
              value: "270"
            - name: SpacesInternal__2__AutoLog2DB
              value: "true"
            - name: SpacesInternal__2__AutoLog2DBLogLevel
              value: Notice
            - name: SpacesInternal__3__Id
              value: staging:SIS-CC-reset
            - name: SpacesInternal__3__DotStatSuiteCoreStructDbConnectionString
              value: Server=dotstatsuite.database.windows.net;Database=$(NSI_RESET_SISCC_STRUCTURE_DB);User=$(NSI_RESET_SISCC_STRUCTURE_USER);Password=$(RESET_STRUCTURE_PASSWORD);
            - name: SpacesInternal__3__DotStatSuiteCoreDataDbConnectionString
              value: Server=dotstatsuite.database.windows.net;Database=$(NSI_RESET_SISCC_DATA_DB);User=$(NSI_RESET_SISCC_DATA_USER);Password=$(RESET_DATA_PASSWORD);
            - name: SpacesInternal__3__DataImportTimeOutInMinutes
              value: "5"
            - name: SpacesInternal__3__DatabaseCommandTimeoutInSec
              value: "270"
            - name: SpacesInternal__3__AutoLog2DB
              value: "true"
            - name: SpacesInternal__3__AutoLog2DBLogLevel
              value: Notice
          ports:
            - name: http
              containerPort: 80
              protocol: TCP
          livenessProbe:
            httpGet:
              path: /live
              port: http
          readinessProbe:
            httpGet:
              path: /health
              port: http
          resources:
            seccompProfile:
              type: RuntimeDefault
      initContainers:
        - name: dbup-nsi-design-oecd-data
          image: siscc/dotstatsuite-dbup:master
          imagePullPolicy: Always
          envFrom:
            - configMapRef:
                name: mssql
          env:
            - name: SA_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: dotstatsuite-db-secret
                  key: sapassword
            - name: PASSWORD
              valueFrom:
                secretKeyRef:
                  name: mssql-nsi-design-oecd-data
                  key: password
          command:
            - bash
            - -c
          args:
            - dotnet DotStat.DbUp.dll upgrade --connectionString "Server=dotstatsuite.database.windows.net;Database=$(NSI_DESIGN_OECD_DATA_DB);User=$(SA_USER);Password=$(SA_PASSWORD);" --dataDb --loginName $(NSI_DESIGN_OECD_DATA_USER) --loginPwd $(PASSWORD) --force
        - name: dbup-nsi-staging-oecd-data
          image: siscc/dotstatsuite-dbup:master
          imagePullPolicy: Always
          envFrom:
            - configMapRef:
                name: mssql
          env:
            - name: SA_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: dotstatsuite-db-secret
                  key: sapassword
            - name: PASSWORD
              valueFrom:
                secretKeyRef:
                  name: mssql-nsi-staging-oecd-data
                  key: password
          command:
            - bash
            - -c
          args:
            - dotnet DotStat.DbUp.dll upgrade --connectionString "Server=dotstatsuite.database.windows.net;Database=$(NSI_STAGING_OECD_DATA_DB);User=$(SA_USER);Password=$(SA_PASSWORD);" --dataDb --loginName $(NSI_STAGING_OECD_DATA_USER) --loginPwd $(PASSWORD) --force
        - name: dbup-nsi-stable-siscc-data
          image: siscc/dotstatsuite-dbup:master
          imagePullPolicy: Always
          envFrom:
            - configMapRef:
                name: mssql
          env:
            - name: SA_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: dotstatsuite-db-secret
                  key: sapassword
            - name: PASSWORD
              valueFrom:
                secretKeyRef:
                  name: mssql-nsi-stable-siscc-data
                  key: password
          command:
            - bash
            - -c
          args:
            - dotnet DotStat.DbUp.dll upgrade --connectionString "Server=dotstatsuite.database.windows.net;Database=$(NSI_STABLE_SISCC_DATA_DB);User=$(SA_USER);Password=$(SA_PASSWORD);" --dataDb --loginName $(NSI_STABLE_SISCC_DATA_USER) --loginPwd $(PASSWORD) --force
        - name: dbup-nsi-reset-siscc-data
          image: siscc/dotstatsuite-dbup:master
          imagePullPolicy: Always
          envFrom:
            - configMapRef:
                name: mssql
          env:
            - name: SA_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: dotstatsuite-db-secret
                  key: sapassword
            - name: PASSWORD
              valueFrom:
                secretKeyRef:
                  name: mssql-nsi-reset-siscc-data
                  key: password
          command:
            - bash
            - -c
          args:
            - dotnet DotStat.DbUp.dll upgrade --connectionString "Server=dotstatsuite.database.windows.net;Database=$(NSI_RESET_SISCC_DATA_DB);User=$(SA_USER);Password=$(SA_PASSWORD);" --dataDb --loginName $(NSI_RESET_SISCC_DATA_USER) --loginPwd $(PASSWORD) --force --dropDb
---
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: release-name-postgresql
  labels:
    app.kubernetes.io/name: postgresql
    helm.sh/chart: postgresql-10.3.2
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: primary
  annotations: null
  namespace: lhb0OLNwy27OOiM
spec:
  serviceName: release-name-postgresql-headless
  replicas: 1
  updateStrategy:
    type: RollingUpdate
  selector:
    matchLabels:
      app.kubernetes.io/name: postgresql
      app.kubernetes.io/instance: release-name
      role: primary
  template:
    metadata:
      name: release-name-postgresql
      labels:
        app.kubernetes.io/name: postgresql
        helm.sh/chart: postgresql-10.3.2
        app.kubernetes.io/instance: release-name
        app.kubernetes.io/managed-by: Helm
        role: primary
        app.kubernetes.io/component: primary
    spec:
      affinity:
        podAffinity: null
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
            - podAffinityTerm:
                labelSelector:
                  matchLabels:
                    app.kubernetes.io/name: postgresql
                    app.kubernetes.io/instance: release-name
                    app.kubernetes.io/component: primary
                namespaces:
                  - default
                topologyKey: kubernetes.io/hostname
              weight: 1
        nodeAffinity: null
      securityContext:
        fsGroup: 1001
      containers:
        - name: release-name-postgresql
          image: docker.io/bitnami/postgresql:11.11.0-debian-10-r0
          imagePullPolicy: IfNotPresent
          resources:
            requests:
              cpu: 250m
              memory: 256Mi
            seccompProfile:
              type: RuntimeDefault
          securityContext:
            runAsUser: 10132
            allowPrivilegeEscalation: false
            capabilities:
              drop:
                "": NET_RAW
            readOnlyRootFilesystem: true
          env:
            - name: BITNAMI_DEBUG
              value: "false"
            - name: POSTGRESQL_PORT_NUMBER
              value: "5432"
            - name: POSTGRESQL_VOLUME_DIR
              value: /bitnami/postgresql
            - name: PGDATA
              value: /bitnami/postgresql/data
            - name: POSTGRES_POSTGRES_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: release-name-postgresql
                  key: postgresql-postgres-password
            - name: POSTGRES_USER
              value: bn_keycloak
            - name: POSTGRES_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: release-name-postgresql
                  key: postgresql-password
            - name: POSTGRES_DB
              value: bitnami_keycloak
            - name: POSTGRESQL_ENABLE_LDAP
              value: "no"
            - name: POSTGRESQL_ENABLE_TLS
              value: "no"
            - name: POSTGRESQL_LOG_HOSTNAME
              value: "false"
            - name: POSTGRESQL_LOG_CONNECTIONS
              value: "false"
            - name: POSTGRESQL_LOG_DISCONNECTIONS
              value: "false"
            - name: POSTGRESQL_PGAUDIT_LOG_CATALOG
              value: "off"
            - name: POSTGRESQL_CLIENT_MIN_MESSAGES
              value: error
            - name: POSTGRESQL_SHARED_PRELOAD_LIBRARIES
              value: pgaudit
          ports:
            - name: tcp-postgresql
              containerPort: 5432
          livenessProbe:
            exec:
              command:
                - /bin/sh
                - -c
                - exec pg_isready -U "bn_keycloak" -d "dbname=bitnami_keycloak" -h 127.0.0.1 -p 5432
            initialDelaySeconds: 30
            periodSeconds: 10
            timeoutSeconds: 5
            successThreshold: 1
            failureThreshold: 6
          readinessProbe:
            exec:
              command:
                - /bin/sh
                - -c
                - -e
                - |
                  exec pg_isready -U "bn_keycloak" -d "dbname=bitnami_keycloak" -h 127.0.0.1 -p 5432
                  [ -f /opt/bitnami/postgresql/tmp/.initialized ] || [ -f /bitnami/postgresql/.initialized ]
            initialDelaySeconds: 5
            periodSeconds: 10
            timeoutSeconds: 5
            successThreshold: 1
            failureThreshold: 6
          volumeMounts:
            - name: dshm
              mountPath: /dev/shm
            - name: data
              mountPath: /bitnami/postgresql
              subPath: null
      volumes:
        - name: dshm
          emptyDir:
            medium: Memory
            sizeLimit: 1Gi
  volumeClaimTemplates:
    - metadata:
        name: data
      spec:
        accessModes:
          - ReadWriteOnce
        resources:
          requests:
            storage: 8Gi
---
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: release-name-keycloa
  namespace: lhb0OLNwy27OOiM
  labels:
    app.kubernetes.io/name: keycloak
    helm.sh/chart: keycloak-2.1.1
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: keycloak
spec:
  replicas: 1
  podManagementPolicy: Parallel
  serviceName: release-name-keycloa-headless
  updateStrategy:
    type: RollingUpdate
  selector:
    matchLabels:
      app.kubernetes.io/name: keycloak
      app.kubernetes.io/instance: release-name
      app.kubernetes.io/component: keycloak
  template:
    metadata:
      annotations:
        checksum/configmap-env-vars: 66f89c9bd434ba6570cc086a2027efc7c13cd519ae2cac11d43f33a310fe9b8c
        checksum/secrets: 426e093a57fee0c3a6b3668284f9bf07e2848e0799cfafbd0e9a05385d50d093
      labels:
        app.kubernetes.io/name: keycloak
        helm.sh/chart: keycloak-2.1.1
        app.kubernetes.io/instance: release-name
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/component: keycloak
    spec:
      serviceAccountName: release-name-keycloa
      affinity:
        podAffinity: null
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
            - podAffinityTerm:
                labelSelector:
                  matchLabels:
                    app.kubernetes.io/name: keycloak
                    app.kubernetes.io/instance: release-name
                namespaces:
                  - default
                topologyKey: kubernetes.io/hostname
              weight: 1
        nodeAffinity: null
      securityContext:
        fsGroup: 1001
      containers:
        - name: keycloak
          image: docker.io/bitnami/keycloak:12.0.3-debian-10-r0
          imagePullPolicy: IfNotPresent
          securityContext:
            runAsNonRoot: true
            runAsUser: 11012
            allowPrivilegeEscalation: false
            capabilities:
              drop:
                "": NET_RAW
            readOnlyRootFilesystem: true
          env:
            - name: KUBERNETES_NAMESPACE
              valueFrom:
                fieldRef:
                  apiVersion: v1
                  fieldPath: metadata.namespace
            - name: BITNAMI_DEBUG
              value: "false"
            - name: KEYCLOAK_ADMIN_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: release-name-keycloak
                  key: admin-password
            - name: KEYCLOAK_MANAGEMENT_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: release-name-keycloak
                  key: management-password
            - name: KEYCLOAK_DATABASE_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: release-name-keycloak
                  key: database-password
          envFrom:
            - configMapRef:
                name: release-name-keycloa-env-vars
          resources:
            limits: {}
            requests: {}
            seccompProfile:
              type: RuntimeDefault
          ports:
            - name: http
              containerPort: 8080
              protocol: TCP
            - name: https
              containerPort: 8443
              protocol: TCP
            - name: http-management
              containerPort: 9990
              protocol: TCP
          livenessProbe:
            failureThreshold: 3
            httpGet:
              path: /auth/
              port: http
            initialDelaySeconds: 300
            periodSeconds: 1
            successThreshold: 1
            timeoutSeconds: 5
          readinessProbe:
            failureThreshold: 3
            httpGet:
              path: /auth/realms/master
              port: http
            initialDelaySeconds: 30
            periodSeconds: 10
            successThreshold: 1
            timeoutSeconds: 1
          volumeMounts: null
      volumes: null
---
apiVersion: networking.k8s.io/v1beta1
kind: Ingress
metadata:
  name: release-name-dotstatsuite-authz
  labels:
    helm.sh/chart: dotstatsuite-0.2.8
    app.kubernetes.io/name: dotstatsuite
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: 1.16.0
    app.kubernetes.io/managed-by: Helm-authz
  annotations:
    kubernetes.io/ingress.class: istio
spec:
  rules:
    - host: authz-siscc.redpelicans.com
      http:
        paths:
          - path: /*
            backend:
              serviceName: release-name-dotstatsuite-authz
              servicePort: 80
---
apiVersion: networking.k8s.io/v1beta1
kind: Ingress
metadata:
  name: release-name-dotstatsuite-nsi-design-oecd
  labels:
    helm.sh/chart: dotstatsuite-0.2.8
    app.kubernetes.io/name: dotstatsuite
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: 1.16.0
    app.kubernetes.io/managed-by: Helm-nsi-design-oecd
  annotations:
    kubernetes.io/ingress.class: istio
spec:
  rules:
    - host: nsi-design-oecd.redpelicans.com
      http:
        paths:
          - path: /*
            backend:
              serviceName: release-name-dotstatsuite-nsi-design-oecd
              servicePort: 80
---
apiVersion: networking.k8s.io/v1beta1
kind: Ingress
metadata:
  name: release-name-dotstatsuite-nsi-reset-siscc
  labels:
    helm.sh/chart: dotstatsuite-0.2.8
    app.kubernetes.io/name: dotstatsuite
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: 1.16.0
    app.kubernetes.io/managed-by: Helm-nsi-reset-siscc
  annotations:
    kubernetes.io/ingress.class: istio
spec:
  rules:
    - host: nsi-reset-siscc.redpelicans.com
      http:
        paths:
          - path: /*
            backend:
              serviceName: release-name-dotstatsuite-nsi-reset-siscc
              servicePort: 80
---
apiVersion: networking.k8s.io/v1beta1
kind: Ingress
metadata:
  name: release-name-dotstatsuite-nsi-stable-siscc
  labels:
    helm.sh/chart: dotstatsuite-0.2.8
    app.kubernetes.io/name: dotstatsuite
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: 1.16.0
    app.kubernetes.io/managed-by: Helm-nsi-stable-siscc
  annotations:
    kubernetes.io/ingress.class: istio
spec:
  rules:
    - host: nsi-stable-siscc.redpelicans.com
      http:
        paths:
          - path: /*
            backend:
              serviceName: release-name-dotstatsuite-nsi-stable-siscc
              servicePort: 80
---
apiVersion: networking.k8s.io/v1beta1
kind: Ingress
metadata:
  name: release-name-dotstatsuite-nsi-staging-oecd
  labels:
    helm.sh/chart: dotstatsuite-0.2.8
    app.kubernetes.io/name: dotstatsuite
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: 1.16.0
    app.kubernetes.io/managed-by: Helm-nsi-staging-oecd
  annotations:
    kubernetes.io/ingress.class: istio
spec:
  rules:
    - host: nsi-staging-oecd.redpelicans.com
      http:
        paths:
          - path: /*
            backend:
              serviceName: release-name-dotstatsuite-nsi-staging-oecd
              servicePort: 80
---
apiVersion: networking.k8s.io/v1beta1
kind: Ingress
metadata:
  name: release-name-dotstatsuite-transfer
  labels:
    helm.sh/chart: dotstatsuite-0.2.8
    app.kubernetes.io/name: dotstatsuite
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: 1.16.0
    app.kubernetes.io/managed-by: Helm-transfer
  annotations:
    kubernetes.io/ingress.class: istio
spec:
  rules:
    - host: transfer-siscc.redpelicans.com
      http:
        paths:
          - path: /*
            backend:
              serviceName: release-name-dotstatsuite-transfer
              servicePort: 80
