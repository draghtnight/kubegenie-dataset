apiVersion: v1
kind: ServiceAccount
metadata:
  name: release-name-authentication-service
  labels:
    helm.sh/chart: authentication-service-0.2.2
    app.kubernetes.io/name: authentication-service
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: 0.0.1
    app.kubernetes.io/managed-by: Helm
---
apiVersion: v1
kind: Secret
metadata:
  name: release-name-authentication-service
type: Opqaue
data:
  POSTGRES_USERNAME: cG9zdGdyZXM=
  POSTGRES_PASSWORD: cG9zdGdyZXM=
  JWT_PRIVATE_KEY: TFMwdExTMUNSVWRKVGlCUVVrbFdRVlJGSUV0RldTMHRMUzB0Q2sxSlNVVjJaMGxDUVVSQlRrSm5hM0ZvYTJsSE9YY3dRa0ZSUlVaQlFWTkRRa3RuZDJkblUydEJaMFZCUVc5SlFrRlJRM3BGY201QlZtWklOVTl0TjBFS1kxcENSbEJxYWxnMFUzbHdaMkozYkdOU09FdHFXRkppTm1VckwwSXpabU0wZWpsUVVYWnVWVEl4VDNscGNYUkRVbXBXZWtONmJsVm1lbTVPTkhCeWN3cDZlRFIzUjJGb2QzbEJjMDFIVFZwclMydERRM2RaZEZOUFkyTTNhamxMWmxWMGJuRnBVV2RKYkZnNVJGWjJWMlJpZVU4dlFtaFhkRE41V0VGd05rNXJDaTlqY0RkcVNtMXZhVTU2UVVoRmRWZDJRa2xTVDJ4a2VURXdSVmsyZGpaYWMybFJOVXhQZUdsQ1RWSk1UWE5DY1ZobE1tNVplRzV5ZDBzeE0zTXphbm9LTm1sTmNYZzJkV0prVm5oVGIxQktRa292VEhsaWVYWmhZMk00T1hWdFIweG1XVkU1VjBKNVQxY3dWVEpuZWpCVFpFNUdZUzlsV2toQmJWUTVaaXRWT1FveVJFTmFSbUpCWkV4b2FWWkJNVWxMV1ZSNVFpdGhXRkpEUW5GVEwzbEdTU3M0YzB4dlQycGpjMDl3TVZKSGFYQTRVM05TZFdKWVUxbEliVlJwYUhCQkNteG1lak5FTWpsd1FXZE5Ra0ZCUlVOblowVkNRVXBTTUUxeEwyb3dSVEZaYUhSYVpHb3daMGxPUjBkeU1rUllVMU4xVFZSaE4wNDBNek13VUdKSFZVY0tNRkJUTjBwQ1NWZHhWREIzWTNGMWVWVkNXVXRXUjJSRFlVUm1iRWhWZFRCNk9VVkJVamQxUTIxbFUyUjNjVXhPY1hwTlFUUkRhRWRSWWxSNVJqRjNiUXBsUjNORE5sbDFTUzlNVERWR1RqaEVjVmN4VWpWUFYwcExkRWhTUXl0QmVWZGlMM2R6YW5SSmNsWTFUakJCZDI1eFVHRlhhR0ptYjJ0UVUzZDRUbEJrQ2tsbWRWSk5aazVrTVVWTU5rcENRVzkwVjB0dFQxZDRSa2hZZUc1R1NVTXhRMEkzTVdoMVlreDZjMkpUZFVObWJGRmFlbEZqVlhKS1ZFMXphbTVFUlZvS1ZHWnVWRUYxT0d3NFZtNU9hemcwTWpGVE5WUnJhbk40VkRrNU5YaFBZVnBZYURkTFRUZE9UakF3Y2xKNlQwOUNPU3RYTmpRNU9EVlRVVGs0VmtWek53cG9iRnBQTjBKSVVuSnRiSEZOYkdOcWRqQkpTWGcxT0VOV1ptaFpjRlpPUldoME4wSlJVbXcwWTNFd1EyZFpSVUV6UjNCSFJWSmlZemRFWmtReVkzVldDa0prUkZWNVduQndVRzlZU1VKdFR6UjZVa2xwY0M5Q1VVZHhUa3RhUmxsUVQzaERUMmhVZEU0NVRHTXdRMlJvZWpVemMyTjVibGw1Wkc5NVRXTlNXbk1LY1ZKUGVIQk9OWG8yTXpCaWRqVkpRVk5oYnpOQ1QxaFpiazUwU21aTGMxcGpSVVU0YlVWSllrTm5Ta3hPWTNCak1DOUlObkpvV0VkMGRFZGlOSEJsY3dwU1IxWXZRUzloT1d4Q1NqUm5WVVpNV2xwTFMwNTFNVVZvTTAxRFoxbEZRWG92ZGt4SmJFWldVM3BrY0dOdU1tbE1aRmxFY0dob09WQTFVbFpXUzFWcUNuWmhVVmd6WTJVd01XbDBhMnRSYmpoc1FVZE9SMDQwY1V0cmJFOWtja053Y0hST01taG9NMGt5ZDBOdFRHMWhZM1o0VjFrMVJVcDJUM1ZwWkZWeWNsTUtVVGRTV1RScU5tVkhiekpVUkhKNFRuTlFNalptV0VWelpVbE5XamRRYUdzM1Z6VkhXbXBRYkVGT05uZFhWa0YxWmtaNEszWkRkVE5vZG5OUWFFdGxjZ280U3pOd01sWkVWak55VFVObldVSjZOWHBhWXl0cFlrWXlSRlZYY1N0VU4wZ3JjMnM0UW5SNmEzbHRlRzl1UzJzNE1uQm9ORkUxWlZVMGRHczBOVkY1Q25aUGQxVjRla05vUWtVeFN5dENWa3R1WjFKMmRXMVBhWHA0YkhsNGFGaDRaWEpsY0U5SmFrRlNhRTR6VlhwRWRtazJRazgxVVZwWmVGUTRTbGhZWlUwS0wyVkVPVTQxVnpoV05sSjNOM0UyVG1wUGMwTTJPVk5KWjJkU01IcE5hamRXYkhaTFJ6ZzViM00yV0VkWmFURm9hR2RPUlVOMFVrVllVVXRDWjBWTlJBbzRaamczZWpoNmRISlBaRGhRWXpab1NVRnVZalpFWldSV2VWWjNSa3RWWkdjMlkzUnRNRXBNVG5oMFdUWlhOMVJXVTBOSVRGaFVNSEV2YVc5clprY3dDbEEwVDFabk1IVXhNazVaYjNORFkwOUZXR0Y2VWxZemJ6WkNRbkJNUTJ0MWNXeHJNRXhuVDBkVVRGVTFlbHB5VkVaek1HMXpNWEZrWlRkUlZXdFpha1FLZFV0R2FqVlZNSHBrUVZaRVVtTmtRMnR1SzFaWmIzZ3llSGhvUzFseFpYQnJhV3MwTVRoRWNrRnZSMEpCVEcxbFQxVnBWR01yYXpWelJWVlFOVlpYUlFwR1drRk1lVzl0V1M5UmFXZFRVR1J3ZUdFNFkySm1MMGRyTlRKdWVFZEpjRFZKWXpkS2IyaFVWMjlhVFdWVlp6UXhTMmc1TjB4dWNVOVVlamRLTjJSRENuTkRNMHBwWVhaQmJIVkJXU3R3Vm04M2JHdDRPRll2V21ZMVdWZExTMmh1Y1dSblYxSmlVbXhTZHpKbE1VOWtPV1JIYmtaeUsyZEpRbGhMTWpCRmFrZ0tVRzVQU1V0b1RHOU5Oa1ZoTTBKVFNrWmhiRFpCWVRSRkNpMHRMUzB0UlU1RUlGQlNTVlpCVkVVZ1MwVlpMUzB0TFMwSw==
  JWT_PUBLIC_KEY: TFMwdExTMUNSVWRKVGlCUVZVSk1TVU1nUzBWWkxTMHRMUzBLVFVsSlFrbHFRVTVDWjJ0eGFHdHBSemwzTUVKQlVVVkdRVUZQUTBGUk9FRk5TVWxDUTJkTFEwRlJSVUZ6ZUVzMWQwWlllQ3RVY0hWM1NFZFJVbFEwTkFveEswVnpjVmxIT0VwWVJXWkRiekV3Vnl0dWRuWjNaRE16VDAwdlZEQk1OVEZPZEZSemIzRnlVV3RaTVdOM2N6VXhTRGcxZW1WTFlUZE5PR1ZOUW0xdkNtTk5aMHhFUW1wSFdrTndRV2R6UjB4VmFtNUlUelF2VTI0eFRGbzJiMnRKUTBwV0wxRXhZakZ1VnpocWRuZFpWbkprT0d4M1MyVnFXbEF6UzJVMGVWb0tjVWxxWTNkQ2VFeHNjbmRUUlZSd1dHTjBaRUpIVDNJcmJXSkphMDlUZW5OWloxUkZVM3BNUVdGc00zUndNazFhTmpoRGRHUTNUalE0SzI5cVMzTmxjZ3B0TTFaalZYRkVlVkZUWm5rNGJUaHlNbTVJVUZCaWNHaHBNekpGVUZablkycHNkRVpPYjAwNVJXNVVVbGQyTTIxU2QwcHJMMWd2YkZCa1ozZHRVbGQzQ2toVE5GbHNVVTVUUTIxRk9HZG1iV3d3VVdkaGEzWTRhRk5RZGt4RE5rUnZNMHhFY1dSVlVtOXhaa1Z5UldKdE1UQnRRalZyTkc5aFVVcFlPRGwzT1hZS1lWRkpSRUZSUVVJS0xTMHRMUzFGVGtRZ1VGVkNURWxESUV0RldTMHRMUzB0Q2c9PQ==
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: release-name-authentication-service
data:
  POSTGRES_URI: postgres.svc.cluster.local
  POSTGRES_PORT: "5432"
  JWT_CLAIMS_EXP_MINUTES: "30"
  AUTH_SECURITY_SALT: "32"
  AUTH_SECURITY_BCRYPT_STRENGTH: "10"
  SPRINGFOX_DOCUMENTATION_SWAGGER-UI_BASE-URL: /documentation
  EXTERNAL_BUSINESS_URL: business.svc.cluster.local
  EXTERNAL_BUSINESS_ENDPOINTS_CREATE: /create
---
apiVersion: v1
kind: Service
metadata:
  name: release-name-authentication-service
  labels: null
spec:
  type: LoadBalancer
  ports:
    - port: 80
      targetPort: 8080
      protocol: TCP
      name: http
  selector: null
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: release-name-authentication-service
  labels: null
spec:
  replicas: 1
  selector:
    matchLabels: null
  template:
    metadata:
      labels: null
    spec:
      serviceAccountName: release-name-authentication-service
      securityContext: {}
      containers:
        - name: authentication-service
          securityContext:
            allowPrivilegeEscalation: false
            capabilities:
              drop:
                "": NET_RAW
            readOnlyRootFilesystem: true
          image: redestroyder/authorization-service:0.0.1
          imagePullPolicy: IfNotPresent
          envFrom:
            - secretRef:
                name: release-name-authentication-service
            - configMapRef:
                name: release-name-authentication-service
          ports:
            - name: http
              containerPort: 8080
              protocol: TCP
          resources:
            seccompProfile:
              type: RuntimeDefault
---
apiVersion: networking.istio.io/v1beta1
kind: Gateway
metadata:
  name: release-name-authentication-service
spec:
  selector: null
  servers:
    - port:
        targetPort: 8080
        number: 80
        name: http
        protocol: HTTP
      hosts:
        - arch.homework
---
apiVersion: v1
kind: Pod
metadata:
  name: release-name-authentication-service-test-connection
  labels:
    helm.sh/chart: authentication-service-0.2.2
    app.kubernetes.io/name: authentication-service
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: 0.0.1
    app.kubernetes.io/managed-by: Helm
  annotations:
    helm.sh/hook: test
spec:
  containers:
    - name: wget
      image: busybox
      command:
        - wget
      args:
        - release-name-authentication-service:80
  restartPolicy: Never
