apiVersion: v1
kind: ConfigMap
metadata:
  name: release-name-srs-enb
  labels:
    app.kubernetes.io/name: srs-enb
    helm.sh/chart: srs-enb-0.1.1
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: 20.10.1
data:
  enb.conf: "#####################################################################\n#                   srsENB configuration file\n#####################################################################\n\n#####################################################################\n# eNB configuration\n#\n# enb_id:         20-bit eNB identifier.\n# mcc:            Mobile Country Code\n# mnc:            Mobile Network Code\n# mme_addr:       IP address of MME for S1 connnection\n# gtp_bind_addr:  Local IP address to bind for GTP connection\n# s1c_bind_addr:  Local IP address to bind for S1AP connection\n# n_prb:          Number of Physical Resource Blocks (6,15,25,50,75,100)\n# tm:             Transmission mode 1-4 (TM1 default)\n# nof_ports:      Number of Tx ports (1 port default, set to 2 for TM2/3/4)\n#\n#####################################################################\n\n[enb]\nenb_id = 0x19B\nmcc = 001\nmnc = 01\nmme_addr = ${MME_ADDR}\ngtp_bind_addr = ${GTP_BIND_ADDR}\ns1c_bind_addr = ${S1C_BIND_ADDR}\nn_prb = 50\n#tm = 4\n#nof_ports = 2\n\n\n#####################################################################\n# eNB configuration files \n#\n# sib_config:  SIB1, SIB2 and SIB3 configuration file \n# note: when enabling mbms, use the sib.conf.mbsfn configuration file which includes SIB13\n# rr_config:   Radio Resources configuration file \n# drb_config:  DRB configuration file \n#####################################################################\n[enb_files]\nsib_config = sib.conf\nrr_config  = rr.conf\ndrb_config = drb.conf\n\n#####################################################################\n# RF configuration\n#\n# dl_earfcn: EARFCN code for DL (only valid if a single cell is configured in rr.conf)\n# tx_gain: Transmit gain (dB). \n# rx_gain: Optional receive gain (dB). If disabled, AGC if enabled\n#\n# Optional parameters:\n# dl_freq:            Override DL frequency corresponding to dl_earfcn\n# ul_freq:            Override UL frequency corresponding to dl_earfcn (must be set if dl_freq is set)\n# device_name:        Device driver family. Supported options: \"auto\" (uses first found), \"UHD\" or \"bladeRF\" \n# device_args:        Arguments for the device driver. Options are \"auto\" or any string. \n#                     Default for UHD: \"recv_frame_size=9232,send_frame_size=9232\"\n#                     Default for bladeRF: \"\"\n# time_adv_nsamples:  Transmission time advance (in number of samples) to compensate for RF delay\n#                     from antenna to timestamp insertion. \n#                     Default \"auto\". B210 USRP: 100 samples, bladeRF: 27.\n#####################################################################\n[rf]\n#dl_earfcn = 3400\ntx_gain = 80\nrx_gain = 40\n\ndevice_name = auto\n\n# For best performance in 2x2 MIMO and >= 15 MHz use the following device_args settings:\n#     USRP B210: num_recv_frames=64,num_send_frames=64\n\n# For best performance when BW<5 MHz (25 PRB), use the following device_args settings:\n#     USRP B210: send_frame_size=512,recv_frame_size=512\n\ndevice_args = auto\n#time_adv_nsamples = auto\n\n# Example for ZMQ-based operation with TCP transport for I/Q samples\n#device_name = zmq\n#device_args = fail_on_disconnect=true,tx_port=tcp://*:2000,rx_port=tcp://localhost:2001,id=enb,base_srate=23.04e6\n\n#####################################################################\n# Packet capture configuration\n#\n# MAC Packets are captured to file in the compact format decoded by \n# the Wireshark mac-lte-framed dissector and with DLT 147. \n# To use the dissector, edit the preferences for DLT_USER to \n# add an entry with DLT=147, Payload Protocol=mac-lte-framed.\n# For more information see: https://wiki.wireshark.org/MAC-LTE\n#\n# Please note that this setting will by default only capture MAC\n# frames on dedicated channels, and not SIB.  You have to build with\n# WRITE_SIB_PCAP enabled in srsenb/src/stack/mac/mac.cc if you want\n# SIB to be part of the MAC pcap file.\n#\n# S1AP Packets are captured to file in the compact format decoded by \n# the Wireshark s1ap dissector and with DLT 150. \n# To use the dissector, edit the preferences for DLT_USER to \n# add an entry with DLT=150, Payload Protocol=s1ap.\n#\n# mac_enable:   Enable MAC layer packet captures (true/false)\n# mac_filename: File path to use for packet captures\n# s1ap_enable:   Enable or disable the PCAP.\n# s1ap_filename: File name where to save the PCAP.\n#\n#####################################################################\n[pcap]\nenable = false\nfilename = /tmp/enb.pcap\ns1ap_enable = false\ns1ap_filename = /tmp/enb_s1ap.pcap\n\n#####################################################################\n# Log configuration\n#\n# Log levels can be set for individual layers. \"all_level\" sets log\n# level for all layers unless otherwise configured.\n# Format: e.g. phy_level = info\n#\n# In the same way, packet hex dumps can be limited for each level.\n# \"all_hex_limit\" sets the hex limit for all layers unless otherwise\n# configured.\n# Format: e.g. phy_hex_limit = 32\n#\n# Logging layers: rf, phy, phy_lib, mac, rlc, pdcp, rrc, gtpu, s1ap, stack, all\n# Logging levels: debug, info, warning, error, none\n#\n# filename: File path to use for log output. Can be set to stdout\n#           to print logs to standard output\n# file_max_size: Maximum file size (in kilobytes). When passed, multiple files are created.\n#                If set to negative, a single log file will be created.\n#####################################################################\n[log]\nall_level = warning\nall_hex_limit = 32\nfilename = stdout\nfile_max_size = -1\n\n[gui]\nenable = false\n\n#####################################################################\n# Scheduler configuration options\n#\n# max_aggr_level:    Optional maximum aggregation level index (l=log2(L) can be 0, 1, 2 or 3)\n# pdsch_mcs:         Optional fixed PDSCH MCS (ignores reported CQIs if specified)\n# pdsch_max_mcs:     Optional PDSCH MCS limit \n# pusch_mcs:         Optional fixed PUSCH MCS (ignores reported CQIs if specified)\n# pusch_max_mcs:     Optional PUSCH MCS limit \n# min_nof_ctrl_symbols: Minimum number of control symbols \n# max_nof_ctrl_symbols: Maximum number of control symbols \n#\n#####################################################################\n[scheduler]\n#max_aggr_level   = -1\n#pdsch_mcs        = -1\n#pdsch_max_mcs    = -1\n#pusch_mcs        = -1\npusch_max_mcs    = 16\n#min_nof_ctrl_symbols = 1\n#max_nof_ctrl_symbols = 3\n\n#####################################################################\n# eMBMS configuration options\n#\n# enable:               Enable MBMS transmission in the eNB\n# m1u_multiaddr:        Multicast addres the M1-U socket will register to\n# m1u_if_addr:          Address of the inteferface the M1-U interface will listen for multicast packets.\n#\n#####################################################################\n[embms]\n#enable = false\n#m1u_multiaddr = 239.255.0.1\n#m1u_if_addr = 127.0.1.201\n\n\n\n#####################################################################\n# Channel emulator options:\n# enable:            Enable/Disable internal Downlink/Uplink channel emulator\n#\n# -- AWGN Generator\n# awgn.enable:       Enable/disable AWGN generator\n# awgn.n0:           Noise power in dBfs\n#\n# -- Fading emulator\n# fading.enable:     Enable/disable fading simulator\n# fading.model:      Fading model + maximum doppler (E.g. none, epa5, eva70, etu300, etc)\n#\n# -- Delay Emulator     delay(t) = delay_min + (delay_max - delay_min) * (1 + sin(2pi*t/period)) / 2\n#                       Maximum speed [m/s]: (delay_max - delay_min) * pi * 300 / period\n# delay.enable:      Enable/disable delay simulator\n# delay.period_s:    Delay period in seconds.\n# delay.init_time_s: Delay initial time in seconds.\n# delay.maximum_us:  Maximum delay in microseconds\n# delay.minumum_us:  Minimum delay in microseconds\n#\n# -- Radio-Link Failure (RLF) Emulator\n# rlf.enable:        Enable/disable RLF simulator\n# rlf.t_on_ms:       Time for On state of the channel (ms)\n# rlf.t_off_ms:      Time for Off state of the channel (ms)\n#\n# -- High Speed Train Doppler model simulator\n# hst.enable:        Enable/Disable HST simulator\n# hst.period_s:      HST simulation period in seconds\n# hst.fd_hz:         Doppler frequency in Hz\n# hst.init_time_s:   Initial time in seconds\n#####################################################################\n[channel.dl]\n#enable        = false\n\n[channel.dl.awgn]\n#enable        = false\n#n0            = -30\n\n[channel.dl.fading]\n#enable        = false\n#model         = none\n\n[channel.dl.delay]\n#enable        = false\n#period_s      = 3600\n#init_time_s   = 0\n#maximum_us    = 100\n#minimum_us    = 10\n\n[channel.dl.rlf]\n#enable        = false\n#t_on_ms       = 10000\n#t_off_ms      = 2000\n\n[channel.dl.hst]\n#enable        = false\n#period_s      = 7.2\n#fd_hz         = 750.0\n#init_time_s   = 0.0\n\n[channel.ul]\n#enable        = false\n\n[channel.ul.awgn]\n#enable        = false\n#n0            = -30\n\n[channel.ul.fading]\n#enable        = false\n#model         = none\n\n[channel.ul.delay]\n#enable        = false\n#period_s      = 3600\n#init_time_s   = 0\n#maximum_us    = 100\n#minimum_us    = 10\n\n[channel.ul.rlf]\n#enable        = false\n#t_on_ms       = 10000\n#t_off_ms      = 2000\n\n[channel.ul.hst]\n#enable        = false\n#period_s      = 7.2\n#fd_hz         = -750.0\n#init_time_s   = 0.0\n\n\n#####################################################################\n# Expert configuration options\n#\n# pusch_max_its:        Maximum number of turbo decoder iterations (Default 4)\n# pusch_8bit_decoder:   Use 8-bit for LLR representation and turbo decoder trellis computation (Experimental)\n# nof_phy_threads:      Selects the number of PHY threads (maximum 4, minimum 1, default 2)\n# metrics_period_secs:  Sets the period at which metrics are requested from the eNB. \n# metrics_csv_enable:   Write eNB metrics to CSV file.\n# metrics_csv_filename: File path to use for CSV metrics.\n# pregenerate_signals:  Pregenerate uplink signals after attach. Improves CPU performance.\n# tx_amplitude:         Transmit amplitude factor (set 0-1 to reduce PAPR)\n# link_failure_nof_err: Number of PUSCH failures after which a radio-link failure is triggered. \n#                       a link failure is when SNR<0 and CRC=KO\n# max_prach_offset_us:  Maximum allowed RACH offset (in us)\n# eea_pref_list:        Ordered preference list for the selection of encryption algorithm (EEA) (default: EEA0, EEA2, EEA1).\n# eia_pref_list:        Ordered preference list for the selection of integrity algorithm (EIA) (default: EIA2, EIA1, EIA0).\n#\n#####################################################################\n[expert]\n#pusch_max_its        = 8 # These are half iterations\n#pusch_8bit_decoder   = false\n#nof_phy_threads      = 3\n#metrics_period_secs  = 1\n#metrics_csv_enable   = false\n#metrics_csv_filename = /tmp/enb_metrics.csv\n#pregenerate_signals  = false\n#tx_amplitude         = 0.6\n#link_failure_nof_err = 50\n#rrc_inactivity_timer = 60000\n#max_prach_offset_us  = 30\n#eea_pref_list = EEA0, EEA2, EEA1\n#eia_pref_list = EIA2, EIA1, EIA0\n"
  rr.conf: "mac_cnfg =\n{\n  phr_cnfg = \n  {\n    dl_pathloss_change = \"dB3\"; // Valid: 1, 3, 6 or INFINITY\n    periodic_phr_timer = 50;\n    prohibit_phr_timer = 0;\n  };\n  ulsch_cnfg = \n  {\n    max_harq_tx = 4;\n    periodic_bsr_timer = 20; // in ms\n    retx_bsr_timer = 320;   // in ms\n  };\n  \n  time_alignment_timer = -1; // -1 is infinity\n};\n\nphy_cnfg =\n{\n  phich_cnfg = \n  {\n    duration  = \"Normal\";\n    resources = \"1/6\"; \n  };\n\n  pusch_cnfg_ded =\n  {\n    beta_offset_ack_idx = 6;\n    beta_offset_ri_idx  = 6;\n    beta_offset_cqi_idx = 6;\n  };\n  \n  // PUCCH-SR resources are scheduled on time-frequeny domain first, then multiplexed in the same resource. \n  sched_request_cnfg =\n  {\n    dsr_trans_max = 64;\n    period = 20;          // in ms\n    //subframe = [1, 11]; // Optional vector of subframe indices allowed for SR transmissions (default uses all)\n    nof_prb = 2;          // number of PRBs on each extreme used for SR (total prb is twice this number)\n  };\n  cqi_report_cnfg =\n  { \n    mode = \"periodic\";\n    simultaneousAckCQI = true;\n    period = 40;                   // in ms\n    //subframe = [0, 10, 20, 30];  // Optional vector of subframe indices every period where CQI resources will be allocated (default uses all)\n    nof_prb = 2; \n    m_ri = 8; // RI period in CQI period\n  };\n};\n\ncell_list =\n(\n  {\n    // rf_port = 0;\n    cell_id = 0x01;\n    tac = 0x0001;\n    pci = 1;\n    // root_seq_idx = 204;\n    dl_earfcn = 3350;\n    //ul_earfcn = 21400;\n    ho_active = false;\n\n    // CA cells\n    scell_list = (\n      // {cell_id = 0x02; cross_carrier_scheduling = false; scheduling_cell_id = 0x02; ul_allowed = true}\n    )\n\n    // Cells available for handover\n    meas_cell_list =\n    (\n      {\n        eci = 0x19C02;\n        dl_earfcn = 2850;\n        pci = 2;\n      }\n    );\n\n    // ReportCfg (only A3 supported)\n    meas_report_desc = {\n      a3_report_type = \"RSRP\";\n      a3_offset = 6;\n      a3_hysteresis = 0;\n      a3_time_to_trigger = 480;\n      rsrq_config = 4;\n    };\n  }\n  // Add here more cells\n);\n"
---
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: release-name-srs-enb
  labels:
    app.kubernetes.io/name: srs-enb
    helm.sh/chart: srs-enb-0.1.1
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: 20.10.1
spec:
  replicas: 1
  serviceName: release-name-srs-enb
  selector:
    matchLabels:
      app.kubernetes.io/name: srs-enb
      app.kubernetes.io/instance: release-name
  template:
    metadata:
      labels:
        app.kubernetes.io/name: srs-enb
        app.kubernetes.io/instance: release-name
    spec:
      containers:
        - name: enb
          image: docker.io/openverso/srs-lte:20_10_1
          imagePullPolicy: IfNotPresent
          args:
            - enb
          env:
            - name: GTP_BIND_INTERFACE
              value: eth0
            - name: S1C_BIND_INTERFACE
              value: eth0
            - name: MME_HOSTNAME
              value: mme
            - name: TAC
              value: "0001"
          securityContext:
            privileged: true
            allowPrivilegeEscalation: false
            capabilities:
              drop:
                "": NET_RAW
            readOnlyRootFilesystem: true
          resources:
            limits:
              ettus.com/usrp: 1
            seccompProfile:
              type: RuntimeDefault
          volumeMounts:
            - name: srsenb-config
              mountPath: /etc/srslte/rr.conf
              subPath: rr.conf
            - name: srsenb-config
              mountPath: /etc/srslte/enb.conf
              subPath: enb.conf
      volumes:
        - name: srsenb-config
          configMap:
            name: release-name-srs-enb
