apiVersion: v1
kind: ServiceAccount
metadata:
  name: release-name-rstudio-workbench
  namespace: 8Vqr9hLlQ
---
apiVersion: v1
kind: Secret
metadata:
  name: release-name-rstudio-workbench-secret
  namespace: 8Vqr9hLlQ
stringData:
  database.conf: ""
  launcher.pem: |
    -----BEGIN RSA PRIVATE KEY-----
    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
    -----END RSA PRIVATE KEY-----
  secure-cookie-key: |
    309fce95-4d47-446d-9259-61e18c9fa030
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: release-name-rstudio-workbench-config
  namespace: 8Vqr9hLlQ
data:
  jupyter.conf: |
    default-session-cluster=Kubernetes
    jupyter-exe=/opt/python/3.6.5/bin/jupyter
    labs-enabled=1
    notebooks-enabled=1
  launcher.conf: |
    [cluster]
    name=Kubernetes
    type=Kubernetes

    [server]
    address=127.0.0.1
    admin-group=rstudio-server
    authorization-enabled=1
    enable-debug-logging=0
    port=5559
    server-user=rstudio-server
    thread-pool-size=4
  launcher.kubernetes.conf: |
    kubernetes-namespace=default
    use-templating=0
  logging.conf: |
    [*]
    log-level=info
    logger-type=stderr
  rserver.conf: |
    admin-enabled=1
    auth-pam-sessions-enabled=1
    launcher-address=127.0.0.1
    launcher-default-cluster=Kubernetes
    launcher-port=5559
    launcher-sessions-callback-address=http://release-name-rstudio-workbench.default.svc.cluster.local:80
    launcher-sessions-enabled=1
    monitor-graphite-client-id=rstudio
    monitor-graphite-enabled=1
    monitor-graphite-host=127.0.0.1
    monitor-graphite-port=9109
    server-health-check-enabled=1
    server-project-sharing=1
    www-port=8787
  vscode-user-settings.json: |
    {
          "terminal.integrated.shell.linux": "/bin/bash",
          "extensions.autoUpdate": false,
          "extensions.autoCheckUpdates": false
    }
  vscode.conf: |
    args=--verbose --host=0.0.0.0
    enabled=1
    exe=/opt/code-server/bin/code-server
  launcher.kubernetes.profiles.conf: |2
    [*]
    allow-unknown-images=1
    container-images=rstudio/r-session-complete:bionic-2022.02.2-485.pro2
    default-container-image=rstudio/r-session-complete:bionic-2022.02.2-485.pro2
    job-json-overrides="/spec/template/spec/volumes/-":"/mnt/job-json-overrides-new/defaultSessionVolume.json","/spec/template/spec/containers/0/volumeMounts/-":"/mnt/job-json-overrides-new/defaultSessionVolumeMount.json"
  launcher-mounts: ""
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: release-name-rstudio-workbench-overrides-new
  namespace: 8Vqr9hLlQ
data:
  defaultSessionVolume.json: |
    {
      "configMap": {
        "defaultMode": 420,
        "name": "release-name-rstudio-workbench-session"
      },
      "name": "session-config"
    }
  defaultSessionVolumeMount.json: |
    {
      "mountPath": "/mnt/session-configmap/rstudio",
      "name": "session-config"
    }
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: release-name-rstudio-workbench-graphite
  namespace: 8Vqr9hLlQ
data:
  graphite-mapping.yaml: |-
    mappings:
    - match: "rstudio\\.([\\w-]+)\\.system\\.load\\.(.*)"
      match_type: regex
      name: "rstudio_system_load"
      labels:
        host: "$1"
        duration: "$2"
    - match: "rstudio\\.([\\w-]+)\\.(.*)"
      match_type: regex
      name: "rstudio_$2"
      labels:
        host: "$1"
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: release-name-rstudio-workbench-prestart
  namespace: 8Vqr9hLlQ
data:
  prestart-workbench.bash: |
    #!/bin/bash
    set -o errexit
    set -o pipefail

    main() {
      local startup_script="${1:-/usr/local/bin/startup.sh}"
      local dyn_dir='/mnt/dynamic/rstudio'

      local launcher_pem='/mnt/secret-configmap/rstudio/launcher.pem'
      local launcher_pub="${dyn_dir}/launcher.pub"

      _logf 'Ensuring %s exists' "${dyn_dir}"
      mkdir -p "${dyn_dir}"

      if [[ ! -s "${launcher_pub}" ]] && [[ -f "${launcher_pem}" ]]; then
        _logf 'Generating %s from %s' "${launcher_pub}" "${launcher_pem}"
        openssl rsa -in "${launcher_pem}" -outform PEM -pubout -out "${launcher_pub}" 2>&1 | _indent
        chmod -v 600 "${launcher_pub}" 2>&1 | _indent
      else
        _logf 'Ensuring %s does not exist' "${launcher_pub}"
        rm -vf "${launcher_pub}" 2>&1 | _indent
      fi

      if [[ -n "$RSW_LOAD_BALANCING" ]]; then
        _logf "Enabling load-balancing by making sure that the /mnt/load-balancer/rstudio/load-balancer file exists"
        mkdir -p /mnt/load-balancer/rstudio/
        touch "/mnt/load-balancer/rstudio/load-balancer"
      fi

      _logf 'Preparing dirs'
      mkdir -p \
        /var/lib/rstudio-server/monitor/log
      chown -v -R \
        rstudio-server:rstudio-server \
        /var/lib/rstudio-server 2>&1 | _indent

      _writeEtcRstudioReadme

      _logf 'Replacing process with %s' "${startup_script}"
      exec "${startup_script}"
    }

    _logf() {
      local msg="${1}"
      shift
      local now
      now="$(date -u +%Y-%m-%dT%H:%M:%S)"
      local format_string
      format_string="$(printf '#----> prestart-workbench.bash %s: %s' "${now}" "${msg}")\\n"
      # shellcheck disable=SC2059
      printf "${format_string}" "${@}"
    }

    _indent() {
      sed -u 's/^/       /'
    }

    _writeEtcRstudioReadme() {
      _logf 'Writing README to empty /etc/rstudio directory'
      (cat <<$HERE$
    The contents of this configuration directory have been moved to other directories
    in order to facilitate running in Kubernetes. The directories are specified via
    the XDG_CONFIG_DIRS environment variable defined in the Helm chart. The currently
    defined directories are:

    $(echo "$XDG_CONFIG_DIRS" | sed 's/:/\n/g')
    $HERE$
      ) > /etc/rstudio/README
    }

    main "${@}"
  prestart-launcher.bash: |
    #!/bin/bash
    set -o errexit
    set -o pipefail

    main() {
      local startup_script="${1:-/usr/lib/rstudio-server/bin/rstudio-launcher}"
      local dyn_dir='/mnt/dynamic/rstudio'

      local cacert='/var/run/secrets/kubernetes.io/serviceaccount/ca.crt'
      local k8s_url="https://${KUBERNETES_SERVICE_HOST}:${KUBERNETES_SERVICE_PORT}"

      _logf 'Loading service account token'
      local sa_token
      sa_token="$(cat /var/run/secrets/kubernetes.io/serviceaccount/token)"

      _logf 'Ensuring %s exists' "${dyn_dir}"
      mkdir -p "${dyn_dir}"

      # Empty if enabled, set to "disabled" by default
      if [[ -z "${RSTUDIO_LAUNCHER_STARTUP_HEALTH_CHECK}" ]]; then
        _logf 'Checking kubernetes health via %s' "${k8s_url}"
        # shellcheck disable=SC2086
        curl ${RSTUDIO_LAUNCHER_STARTUP_HEALTH_CHECK_ARGS} \
          -H "Authorization: Bearer ${sa_token}" \
          --cacert "${cacert}" \
          "${k8s_url}/livez?verbose" 2>&1 | _indent
        printf '\n'
      else
        _logf "Not checking kubernetes health because RSTUDIO_LAUNCHER_STARTUP_HEALTH_CHECK=${RSTUDIO_LAUNCHER_STARTUP_HEALTH_CHECK}"
        printf '\n'
      fi

      _logf 'Configuring certs'
      cp -v "${cacert}" ${dyn_dir}/k8s-cert 2>&1 | _indent
      mkdir -p /usr/local/share/ca-certificates/Kubernetes
      cp -v \
        ${dyn_dir}/k8s-cert \
        /usr/local/share/ca-certificates/Kubernetes/cert-Kubernetes.crt 2>&1 | _indent

      _logf 'Updating CA certificates'
      PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin \
        update-ca-certificates 2>&1 | _indent

      _logf 'Preparing dirs'
      mkdir -p \
        /var/lib/rstudio-launcher/Local \
        /var/lib/rstudio-launcher/Kubernetes
      chown -v -R \
        rstudio-server:rstudio-server \
        /var/lib/rstudio-launcher 2>&1 | _indent

      _logf 'Replacing process with %s' "${startup_script}"
      exec "${startup_script}"
    }

    _logf() {
      local msg="${1}"
      shift
      local now
      now="$(date -u +%Y-%m-%dT%H:%M:%S)"
      local format_string
      format_string="$(printf '#----> prestart-launcher.bash %s: %s' "${now}" "${msg}")\\n"
      # shellcheck disable=SC2059
      printf "${format_string}" "${@}"
    }

    _indent() {
      sed -u 's/^/       /'
    }

    main "${@}"
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: release-name-rstudio-workbench-session
  namespace: 8Vqr9hLlQ
data:
  notifications.conf: ""
  repos.conf: |
    CRAN=https://packagemanager.rstudio.com/cran/__linux__/bionic/latest
    RSPM=https://packagemanager.rstudio.com/cran/__linux__/bionic/latest
  rsession.conf: ""
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: release-name-rstudio-workbench-start-rsw
  namespace: 8Vqr9hLlQ
data:
  rstudio-workbench.conf: |
    [program:rstudio-workbench]
    command=/scripts/prestart-workbench.bash /usr/local/bin/startup.sh
    autorestart=false
    numprocs=1
    stdout_logfile=/dev/stdout
    stdout_logfile_maxbytes=0
    stderr_logfile=/dev/stderr
    stderr_logfile_maxbytes=0
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: release-name-rstudio-workbench-start-launcher
  namespace: 8Vqr9hLlQ
data:
  rstudio-launcher.conf: |
    [program:rstudio-launcher]
    command=/scripts/prestart-launcher.bash /usr/lib/rstudio-server/bin/rstudio-launcher
    autorestart=false
    numprocs=1
    stdout_logfile=/dev/stdout
    stdout_logfile_maxbytes=0
    stderr_logfile=/dev/stderr
    stderr_logfile_maxbytes=0
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: release-name-rstudio-workbench-start-user
  namespace: 8Vqr9hLlQ
data:
  sssd.conf: |
    [program:sssd]
    command=/usr/sbin/sssd -i -c /etc/sssd/sssd.conf --logger=stderr
    autorestart=false
    numprocs=1
    stdout_logfile=/dev/stdout
    stdout_logfile_maxbytes=0
    stdout_logfile_backups=0
    stderr_logfile=/dev/stderr
    stderr_logfile_maxbytes=0
    stderr_logfile_backups=0
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: release-name-rstudio-workbench
  namespace: 8Vqr9hLlQ
rules:
  - apiGroups:
      - ""
    resources:
      - pods
      - pods/log
      - pods/attach
      - pods/exec
    verbs:
      - get
      - create
      - update
      - patch
      - watch
      - list
      - delete
  - apiGroups:
      - ""
    resources:
      - events
    verbs:
      - watch
  - apiGroups:
      - ""
    resources:
      - services
    verbs:
      - create
      - get
      - watch
      - list
      - delete
  - apiGroups:
      - batch
    resources:
      - jobs
    verbs:
      - create
      - update
      - patch
      - get
      - watch
      - list
      - delete
  - apiGroups:
      - metrics.k8s.io
    resources:
      - pods
    verbs:
      - get
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: release-name-rstudio-workbench
  namespace: 8Vqr9hLlQ
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: release-name-rstudio-workbench
subjects:
  - kind: ServiceAccount
    name: release-name-rstudio-workbench
    namespace: default
---
apiVersion: v1
kind: Service
metadata:
  name: release-name-rstudio-workbench
  namespace: 8Vqr9hLlQ
  labels:
    helm.sh/chart: rstudio-workbench-0.5.14
    app.kubernetes.io/name: rstudio-workbench
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: 2022.02.2-485.pro2
    app.kubernetes.io/managed-by: Helm
  annotations: null
spec:
  type: NodePort
  selector:
    app.kubernetes.io/name: rstudio-workbench
    app.kubernetes.io/instance: release-name
  ports:
    - protocol: TCP
      port: 80
      targetPort: 8787
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: release-name-rstudio-workbench
  namespace: 8Vqr9hLlQ
spec:
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxUnavailable: 0
      maxSurge: 100%
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: rstudio-workbench
      app.kubernetes.io/instance: release-name
  template:
    metadata:
      annotations:
        checksum/config-general: 794346779d2864339570aca7b800bb57dfacbad81879c7c13811ca0d6e1a5c1f
        checksum/config-graphite: 729d1a8f0542a716b30c70e8e8cdb2698213f7a2051717900abaf0725ce83d2d
        checksum/config-prestart: 3829aa3b9723b03abc40449adf7a7b3252d37fa6bae698d60d0ebfd610a8267a
        checksum/config-secret: 47ea6492ba3026a6c6218a4df8838adc3ee3438a96d0201f5569cc5171f02486
        checksum/config-session: 10fc8e7f62a11f67ff8d91bc3bd20cbe4c2b72b9edf026e6c3c6fabb5f5dc9d6
        prometheus.io/scrape: "true"
        prometheus.io/path: /metrics
        prometheus.io/port: "9108"
      labels:
        app.kubernetes.io/name: rstudio-workbench
        app.kubernetes.io/instance: release-name
    spec:
      serviceAccountName: release-name-rstudio-workbench
      shareProcessNamespace: false
      containers:
        - name: rstudio
          image: rstudio/rstudio-workbench:2022.02.2-485.pro2
          env:
            - name: RSTUDIO_LAUNCHER_STARTUP_HEALTH_CHECK_ARGS
              value: -fsSL
            - name: RSTUDIO_LAUNCHER_NAMESPACE
              value: default
            - name: RSW_LAUNCHER
              value: "true"
            - name: RSW_TESTUSER
              value: ""
            - name: XDG_CONFIG_DIRS
              value: /mnt/dynamic:/mnt/session-configmap:/mnt/secret-configmap:/mnt/configmap:/mnt/load-balancer/
          imagePullPolicy: IfNotPresent
          ports:
            - containerPort: 8787
          securityContext:
            allowPrivilegeEscalation: false
            capabilities:
              drop:
                "": NET_RAW
            readOnlyRootFilesystem: true
          volumeMounts:
            - name: rstudio-prestart
              mountPath: /scripts/
            - name: rstudio-config
              mountPath: /mnt/configmap/rstudio/
            - name: rstudio-session-config
              mountPath: /mnt/session-configmap/rstudio/
            - name: rstudio-secret
              mountPath: /mnt/secret-configmap/rstudio/
            - name: etc-rstudio
              mountPath: /etc/rstudio
            - name: rstudio-rsw-startup
              mountPath: /startup/base
            - name: rstudio-launcher-startup
              mountPath: /startup/launcher
            - name: rstudio-user-startup
              mountPath: /startup/user-provisioning
            - name: rstudio-job-overrides-new
              mountPath: /mnt/job-json-overrides-new
          resources:
            limits: null
            seccompProfile:
              type: RuntimeDefault
          readinessProbe:
            failureThreshold: 3
            httpGet:
              path: /health-check
              port: 8787
            initialDelaySeconds: 3
            periodSeconds: 3
            successThreshold: 1
            timeoutSeconds: 1
        - name: exporter
          image: prom/graphite-exporter:v0.9.0
          imagePullPolicy: IfNotPresent
          args:
            - --graphite.mapping-config=/mnt/graphite/graphite-mapping.yaml
          volumeMounts:
            - name: graphite-exporter-config
              mountPath: /mnt/graphite/
      volumes:
        - name: rstudio-job-overrides-new
          configMap:
            name: release-name-rstudio-workbench-overrides-new
            defaultMode: 420
        - name: etc-rstudio
          emptyDir: {}
        - name: rstudio-config
          configMap:
            name: release-name-rstudio-workbench-config
            defaultMode: 420
        - name: rstudio-session-config
          configMap:
            name: release-name-rstudio-workbench-session
            defaultMode: 420
        - name: rstudio-prestart
          configMap:
            name: release-name-rstudio-workbench-prestart
            defaultMode: 493
        - name: rstudio-rsw-startup
          configMap:
            name: release-name-rstudio-workbench-start-rsw
            defaultMode: 493
        - name: rstudio-launcher-startup
          configMap:
            name: release-name-rstudio-workbench-start-launcher
            defaultMode: 493
        - name: rstudio-user-startup
          configMap:
            name: release-name-rstudio-workbench-start-user
            defaultMode: 493
        - name: rstudio-secret
          secret:
            secretName: release-name-rstudio-workbench-secret
            defaultMode: 384
        - name: graphite-exporter-config
          configMap:
            name: release-name-rstudio-workbench-graphite
            defaultMode: 420
---
apiVersion: v1
kind: Pod
metadata:
  name: release-name-rstudio-workbench-test
  annotations:
    helm.sh/hook: test
spec:
  serviceAccountName: release-name-rstudio-workbench
  shareProcessNamespace: false
  restartPolicy: Never
  containers:
    - name: rstudio
      image: rstudio/rstudio-workbench:2022.02.2-485.pro2
      env:
        - name: DIAGNOSTIC_DIR
          value: /var/log/rstudio
        - name: DIAGNOSTIC_ONLY
          value: "true"
        - name: DIAGNOSTIC_ENABLE
          value: "true"
        - name: RSTUDIO_LAUNCHER_STARTUP_HEALTH_CHECK_ARGS
          value: -fsSL
        - name: RSTUDIO_LAUNCHER_NAMESPACE
          value: default
        - name: RSW_LAUNCHER
          value: "true"
        - name: RSW_TESTUSER
          value: rstudio
        - name: RSW_TESTUSER_UID
          value: "10000"
        - name: RSW_TESTUSER_PASSWD
          value: rstudio
        - name: XDG_CONFIG_DIRS
          value: /mnt/dynamic:/mnt/session-configmap:/mnt/secret-configmap:/mnt/configmap:/mnt/load-balancer/
      imagePullPolicy: IfNotPresent
      ports:
        - containerPort: 8787
      securityContext: {}
      volumeMounts:
        - name: rstudio-prestart
          mountPath: /scripts/
        - name: rstudio-config
          mountPath: /mnt/configmap/rstudio/
        - name: rstudio-session-config
          mountPath: /mnt/session-configmap/rstudio/
        - name: rstudio-secret
          mountPath: /mnt/secret-configmap/rstudio/
        - name: etc-rstudio
          mountPath: /etc/rstudio
        - name: rstudio-rsw-startup
          mountPath: /startup/base
        - name: rstudio-launcher-startup
          mountPath: /startup/launcher
        - name: rstudio-user-startup
          mountPath: /startup/user-provisioning
        - name: rstudio-job-overrides-new
          mountPath: /mnt/job-json-overrides-new
      resources:
        limits: null
  volumes:
    - name: rstudio-job-overrides-new
      configMap:
        name: release-name-rstudio-workbench-overrides-new
        defaultMode: 420
    - name: etc-rstudio
      emptyDir: {}
    - name: rstudio-config
      configMap:
        name: release-name-rstudio-workbench-config
        defaultMode: 420
    - name: rstudio-session-config
      configMap:
        name: release-name-rstudio-workbench-session
        defaultMode: 420
    - name: rstudio-prestart
      configMap:
        name: release-name-rstudio-workbench-prestart
        defaultMode: 493
    - name: rstudio-rsw-startup
      configMap:
        name: release-name-rstudio-workbench-start-rsw
        defaultMode: 493
    - name: rstudio-launcher-startup
      configMap:
        name: release-name-rstudio-workbench-start-launcher
        defaultMode: 493
    - name: rstudio-user-startup
      configMap:
        name: release-name-rstudio-workbench-start-user
        defaultMode: 493
    - name: rstudio-secret
      secret:
        secretName: release-name-rstudio-workbench-secret
        defaultMode: 384
