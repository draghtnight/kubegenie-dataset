apiVersion: v1
kind: Secret
metadata:
  name: vmme-keys
  namespace: ca9FfQqw
type: Opaque
data:
  id_rsa: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcGdJQkFBS0NBUUVBeStTK2J3N0VOVzVrbm9yTVRIL3htUktyL09hQng3dWtSUk5lMVdLRXdMZ1FiQjBKCnhFem5IRzBFL09ha2djdVRRREFDQXJUbmRlWWwySDVycGRIaFhraDZFSzlSOXlBRjA5SW4rZ0RjVnpwdlAyZHEKNVVUYllUaElMSXcwRlBYNkRjVU9NSkxNb011WHFTcG14SVRLbXhXWTdvK00ySDByVDh4UDRKQlVoUFVJNFNqRgptaVpzaXhYNnZYL0E1d3ZrMHhPTlN1WWhtN2EycHErNmgwbHJDaXN1K1YxZWpHV1N5eFJNYTBLcFdBNVN3TmxkCkdtSHN3cXBkM3dmZWlpWm4raGlVVTk0OTJPNkZtbys0Qk16QXNuQU5rSUQvR1RSUy85a05hb0wwRVhPaU9PdngKMUlqb2R5RS9DMVEzYU5tVkovYXF6V3Bua05jMGUydnNBYjJDRlFJREFRQUJBb0lCQVFER1JaQnlDdGYrWlhWdgpQdVhnVm1Lb1NpSDVjbVl0eG1pOXkxSmpDc1N4YTh4OGRkaHpqWjBJWlhOK1F3TWlQTWJhbWxTNk1SVUw3MXhLCkpOV2xrRzBwOUN6UFlNM0NGTi9WMWYyTi9aeEhMc25UekV1RTIrckJwYXQ1dG5WSEZOT3U1RHNpUFA3RU5uY3EKeDlMYnM0NGFOV3hjUURma3BnT2lPN3BKVTlEODRGWXVKYkg2RWhIQ3QxbnV5VWVIYUc3cXFzRFluYUdvNk5TYwpxcW5tcnZvU0JPUStDSVhncVJ3R3VldE45a05GL25LT1d4V2laK1ZBWUlYYjdjbmttT1dUZzVvalBpZkNXTWVFCnhpVjlhZ0Z6RUVKaFB4aGl2RnRJcTBYdnNpU2xBWnZaY1JFWEtheXc2ekZ4OUpUZ3BPWFlsbit4ZzBwUUVWWHIKTUxXdjdCVFpBb0dCQVBMeTFaN3FqZVI5UHdUWmVuOTcwQVMzQnNBVFFBY0FoNGFFSEdQeHdMbVdEa2h6SlRXNwpDMlU0ZFN5akIxVzZPTDZ5NHU3YWdnTzVuc2hzRVVaNzNoRTM3YjEvc3IxUFlDK05YdVh1VGhEWURGRDNmNUxBCkh3VTBYdngrdWliVjc1K1hwT2tDbFNCa2YyazZlQkZENjhQYUx5amZDU25Fa3p1a1dQdG5neFJUQW9HQkFOYlkKelhGS0lyY1F0QXoycDMrdHhVOVhxYTV4SzJyUWZMdXJjNjZ4eHhDM0tPOG9NaFlQMmh0aWVZUnlnd2c5MUpSMgpCdTZzWDgrdDVNTllTc28xdDhDU08zNnRjZ1VEb3dvKzJYdXZZOUZ3UVVnVmlITktPYjdjRnJOU2dXTVZoYm5nCi9aZ3hLcm5WbDFOUEJpdkRWNWtQZytqRDFCSU9VbFFpbXlyRDZzTDNBb0dCQU9ublJDWnBXczFHakhybHk1dWIKbjg0NlRNUjJoQ2w1cUFHcGhnL3ZmSWJ4WXJUOEx6SUk4RksyeFpHQk1KbW4zZVEwSkdxa2M1S1VqcndWMTVnTgp2K0xCL3lGNEphVkFHN0lNb1BZc3RucGZGNVNJaFFuTDhORzQ5MDZQMERkOXQrUG1RejZYWHU0OTg3RmpPcUFjCnpZdlZyNXZoQ0ZodlN2V2NLSk43dUdiREFvR0JBS3ZKZXF1bExaRFhDRUI5VUh6a3d5bW4zSU1nOWloWVFBUUgKR1Y2THc3SDM0Z0VvVUxRWFJMdzB4eGxDUHNkdU9QWGtVYkt4bllKL2RyVkRlYm1wcmgyS1Q0d0F2M1NHN2V5WgpTR2gvV3Y3eUZTREFKdlNZV3dmakR6dWZNdG01TWMzb3VwemdZMXRvRDdHTE5GSDF4YXNiSHN3VkdSSys1TkZsClFsQzFpcGNOQW9HQkFJeHFHeUNhaTZidHdEbGJwa2RJK2NrMmo3azluZFo4c29zYzBHMnNlOWQ1OHNmc0hkV2UKMXdwcWU2MnQ3bVFacitJZ0V5cTdSdXVFdFJSNlhxYjhSUXFBdUVkU21zMXpjV2MzMFNKSmhQaXd4SWVMTDBkeApseS9IQkJxbm96RDRCTjNFTmlxbkloT2dlWkU3WEhhUzQzbHVZa1lwQk91QmFXWXM1SUlaV2NjdAotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo=
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: vmme
data:
  serviceConfig: |
    name: vmme
    accessor:
      username: "admin@opencord.org"
      password: "letmein"
      endpoint: xos-core:50051
    logging:
      version: 1
      handlers:
        console:
          class: logging.StreamHandler
        file:
          class: logging.handlers.RotatingFileHandler
          filename: /var/log/xos.log
          maxBytes: 10485760
          backupCount: 5
        kafka:
          class: kafkaloghandler.KafkaLogHandler
          bootstrap_servers:
            - "cord-kafka:9092"
          topic: xos.log.vmme
      loggers:
        '':
          handlers:
            - console
            - file
            - kafka
          level: DEBUG
    proxy_ssh:
      enabled: true
      user: root
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: release-name-vmme
  labels:
    app: vmme
    chart: vmme-1.0.5
    release: release-name
    heritage: Helm
spec:
  replicas: 1
  selector:
    matchLabels:
      app: vmme
      release: release-name
  template:
    metadata:
      labels:
        app: vmme
        release: release-name
      annotations:
        checksum/config: bd214774122b1153eacc574ee6b9f512a5f6d83a9213a04fb43c79f375b2fd58
    spec:
      containers:
        - name: vmme
          image: xosproject/vmme-synchronizer:1.0.3
          imagePullPolicy: Always
          resources:
            seccompProfile:
              type: RuntimeDefault
          volumeMounts:
            - name: vmme-config
              mountPath: /opt/xos/synchronizers/vmme/mounted_config.yaml
              subPath: mounted_config.yaml
            - name: certchain-volume
              mountPath: /usr/local/share/ca-certificates/local_certs.crt
              subPath: config/ca_cert_chain.pem
            - name: vmme-keys
              mountPath: /opt/xos/services/vmme/keys
              readOnly: true
            - name: node-key
              mountPath: /opt/cord_profile
              readOnly: true
      volumes:
        - name: vmme-config
          configMap:
            name: vmme
            items:
              - key: serviceConfig
                path: mounted_config.yaml
        - name: certchain-volume
          configMap:
            name: ca-certificates
            items:
              - key: chain
                path: config/ca_cert_chain.pem
        - name: vmme-keys
          secret:
            secretName: vmme-keys
        - name: node-key
          secret:
            secretName: node-key
            defaultMode: 256
            optional: true
